<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.8.24">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="author" content="Maria Tackett">

<title>10&nbsp; Model selection – Introduction to Regression Analysis</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
html { -webkit-text-size-adjust: 100%; }
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
/* CSS for citations */
div.csl-bib-body { }
div.csl-entry {
  clear: both;
  margin-bottom: 0em;
}
.hanging-indent div.csl-entry {
  margin-left:2em;
  text-indent:-2em;
}
div.csl-left-margin {
  min-width:2em;
  float:left;
}
div.csl-right-inline {
  margin-left:2em;
  padding-left:1em;
}
div.csl-indent {
  margin-left: 2em;
}</style>


<script src="site_libs/quarto-nav/quarto-nav.js"></script>
<script src="site_libs/quarto-nav/headroom.min.js"></script>
<script src="site_libs/clipboard/clipboard.min.js"></script>
<script src="site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="site_libs/quarto-search/fuse.min.js"></script>
<script src="site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="./">
<link href="./11-logistic.html" rel="next">
<link href="./09-mlr-transformations.html" rel="prev">
<script src="site_libs/quarto-html/quarto.js" type="module"></script>
<script src="site_libs/quarto-html/tabsets/tabsets.js" type="module"></script>
<script src="site_libs/quarto-html/axe/axe-check.js" type="module"></script>
<script src="site_libs/quarto-html/popper.min.js"></script>
<script src="site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="site_libs/quarto-html/anchor.min.js"></script>
<link href="site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="site_libs/quarto-html/quarto-syntax-highlighting-dc55a5b9e770e841cd82e46aadbfb9b0.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="site_libs/bootstrap/bootstrap.min.js"></script>
<link href="site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="site_libs/bootstrap/bootstrap-31c3c5ec0f84e3846e28bd1517aa8340.min.css" rel="stylesheet" append-hash="true" id="quarto-bootstrap" data-mode="light">
<script src="site_libs/quarto-contrib/glightbox/glightbox.min.js"></script>
<link href="site_libs/quarto-contrib/glightbox/glightbox.min.css" rel="stylesheet">
<link href="site_libs/quarto-contrib/glightbox/lightbox.css" rel="stylesheet">
<script id="quarto-search-options" type="application/json">{
  "location": "sidebar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "start",
  "type": "textbox",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>
<script defer="" data-domain="https://matackett.github.io/regression-book/" src="https://plausible.io/js/script.js"></script>

  <script src="https://cdnjs.cloudflare.com/polyfill/v3/polyfill.min.js?features=es6"></script>
  <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js" type="text/javascript"></script>

<script type="text/javascript">
const typesetMath = (el) => {
  if (window.MathJax) {
    // MathJax Typeset
    window.MathJax.typeset([el]);
  } else if (window.katex) {
    // KaTeX Render
    var mathElements = el.getElementsByClassName("math");
    var macros = [];
    for (var i = 0; i < mathElements.length; i++) {
      var texText = mathElements[i].firstChild;
      if (mathElements[i].tagName == "SPAN" && texText && texText.data) {
        window.katex.render(texText.data, mathElements[i], {
          displayMode: mathElements[i].classList.contains('display'),
          throwOnError: false,
          macros: macros,
          fleqn: false
        });
      }
    }
  }
}
window.Quarto = {
  typesetMath
};
</script>

</head>

<body class="nav-sidebar floating quarto-light">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
  <nav class="quarto-secondary-nav">
    <div class="container-fluid d-flex">
      <button type="button" class="quarto-btn-toggle btn" data-bs-toggle="collapse" role="button" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
        <i class="bi bi-layout-text-sidebar-reverse"></i>
      </button>
        <nav class="quarto-page-breadcrumbs" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="./07-mlr.html">Part 3: Multiple linear regression</a></li><li class="breadcrumb-item"><a href="./10-model-eval.html"><span class="chapter-number">10</span>&nbsp; <span class="chapter-title">Model selection</span></a></li></ol></nav>
        <a class="flex-grow-1" role="navigation" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">      
        </a>
      <button type="button" class="btn quarto-search-button" aria-label="Search" onclick="window.quartoOpenSearch();">
        <i class="bi bi-search"></i>
      </button>
    </div>
  </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse collapse-horizontal quarto-sidebar-collapse-item sidebar-navigation floating overflow-auto">
    <div class="pt-lg-2 mt-2 text-left sidebar-header sidebar-header-stacked">
      <a href="./index.html" class="sidebar-logo-link">
      </a>
    <div class="sidebar-title mb-0 py-0">
      <a href="./">Introduction to Regression Analysis</a> 
        <div class="sidebar-tools-main">
    <a href="https://github.com/matackett/regression-book" title="Source Code" class="quarto-navigation-tool px-1" aria-label="Source Code"><i class="bi bi-github"></i></a>
  <a href="" class="quarto-reader-toggle quarto-navigation-tool px-1" onclick="window.quartoToggleReader(); return false;" title="Toggle reader mode">
  <div class="quarto-reader-toggle-btn">
  <i class="bi"></i>
  </div>
</a>
</div>
    </div>
      </div>
        <div class="mt-2 flex-shrink-0 align-items-center">
        <div class="sidebar-search">
        <div id="quarto-search" class="" title="Search"></div>
        </div>
        </div>
    <div class="sidebar-menu-container"> 
    <ul class="list-unstyled mt-1">
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Welcome</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./00-preface.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Preface</span></a>
  </div>
</li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" role="navigation" aria-expanded="true">
 <span class="menu-text">Part 1: Getting started</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-1" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./01-intro.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">1</span>&nbsp; <span class="chapter-title">Regression in the data science workflow</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./02-review-r.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">2</span>&nbsp; <span class="chapter-title">Data analysis in R</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./03-eda.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">3</span>&nbsp; <span class="chapter-title">Exploratory data analysis</span></span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-2" role="navigation" aria-expanded="true">
 <span class="menu-text">Part 2: Simple linear regression</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-2" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-2" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./04-slr.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">4</span>&nbsp; <span class="chapter-title">Simple linear regression</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./05-slr-inference.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">5</span>&nbsp; <span class="chapter-title">Inference for simple linear regression</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./06-slr-conditions.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">6</span>&nbsp; <span class="chapter-title">Model conditions and diagnostics</span></span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-3" role="navigation" aria-expanded="true">
 <span class="menu-text">Part 3: Multiple linear regression</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-3" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-3" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./07-mlr.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">7</span>&nbsp; <span class="chapter-title">Multiple linear regression</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./08-mlr-inference.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">8</span>&nbsp; <span class="chapter-title">Inference for multiple linear regression</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./09-mlr-transformations.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">9</span>&nbsp; <span class="chapter-title">Variable transformations</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./10-model-eval.html" class="sidebar-item-text sidebar-link active">
 <span class="menu-text"><span class="chapter-number">10</span>&nbsp; <span class="chapter-title">Model selection</span></span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-4" role="navigation" aria-expanded="true">
 <span class="menu-text">Part 4: Beyond linear regression</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-4" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-4" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./11-logistic.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">11</span>&nbsp; <span class="chapter-title">Logistic regression</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./12-logistic-prediction.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">12</span>&nbsp; <span class="chapter-title">Logistic regression: Prediction and evaluation</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./13-special-topics.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">13</span>&nbsp; <span class="chapter-title">Special topics</span></span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-5" role="navigation" aria-expanded="true">
 <span class="menu-text">Appendices</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-5" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-5" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./appendix-linear.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">A</span>&nbsp; <span class="chapter-title">Mathematics of linear regression</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./appendix-logistic.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">B</span>&nbsp; <span class="chapter-title">Mathematics of logistic regression</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./datasets.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">C</span>&nbsp; <span class="chapter-title">Data sets</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./references.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">References</span></a>
  </div>
</li>
      </ul>
  </li>
    </ul>
    </div>
</nav>
<div id="quarto-sidebar-glass" class="quarto-sidebar-collapse-item" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item"></div>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">Table of contents</h2>
   
  <ul>
  <li><a href="#learning-goals" id="toc-learning-goals" class="nav-link active" data-scroll-target="#learning-goals">Learning goals</a></li>
  <li><a href="#sec-spotify-intro" id="toc-sec-spotify-intro" class="nav-link" data-scroll-target="#sec-spotify-intro"><span class="header-section-number">10.1</span> Introduction: Moody music</a>
  <ul class="collapse">
  <li><a href="#exploratory-data-analysis" id="toc-exploratory-data-analysis" class="nav-link" data-scroll-target="#exploratory-data-analysis"><span class="header-section-number">10.1.1</span> Exploratory data analysis</a></li>
  </ul></li>
  <li><a href="#sec-model-compare-stats" id="toc-sec-model-compare-stats" class="nav-link" data-scroll-target="#sec-model-compare-stats"><span class="header-section-number">10.2</span> Statistics for model comparison</a>
  <ul class="collapse">
  <li><a href="#sec-adj-rsq" id="toc-sec-adj-rsq" class="nav-link" data-scroll-target="#sec-adj-rsq"><span class="header-section-number">10.2.1</span> Adjusted <span class="math inline">\(R^2\)</span></a></li>
  <li><a href="#root-mean-square-error-rmse" id="toc-root-mean-square-error-rmse" class="nav-link" data-scroll-target="#root-mean-square-error-rmse"><span class="header-section-number">10.2.2</span> Root Mean Square Error (RMSE)</a></li>
  <li><a href="#sec-aic-bic" id="toc-sec-aic-bic" class="nav-link" data-scroll-target="#sec-aic-bic"><span class="header-section-number">10.2.3</span> AIC and BIC</a></li>
  </ul></li>
  <li><a href="#sec-stepwise-selection" id="toc-sec-stepwise-selection" class="nav-link" data-scroll-target="#sec-stepwise-selection"><span class="header-section-number">10.3</span> Stepwise model selection</a>
  <ul class="collapse">
  <li><a href="#sec-stepwise-forward" id="toc-sec-stepwise-forward" class="nav-link" data-scroll-target="#sec-stepwise-forward"><span class="header-section-number">10.3.1</span> Forward selection</a></li>
  <li><a href="#backward-selection" id="toc-backward-selection" class="nav-link" data-scroll-target="#backward-selection"><span class="header-section-number">10.3.2</span> Backward selection</a></li>
  </ul></li>
  <li><a href="#sec-training-testing" id="toc-sec-training-testing" class="nav-link" data-scroll-target="#sec-training-testing"><span class="header-section-number">10.4</span> Training and testing sets</a>
  <ul class="collapse">
  <li><a href="#using-training-and-testing-sets" id="toc-using-training-and-testing-sets" class="nav-link" data-scroll-target="#using-training-and-testing-sets"><span class="header-section-number">10.4.1</span> Using training and testing sets</a></li>
  <li><a href="#model-building-workflow-example" id="toc-model-building-workflow-example" class="nav-link" data-scroll-target="#model-building-workflow-example"><span class="header-section-number">10.4.2</span> Model building workflow example</a></li>
  </ul></li>
  <li><a href="#cross-validation" id="toc-cross-validation" class="nav-link" data-scroll-target="#cross-validation"><span class="header-section-number">10.5</span> Cross validation</a>
  <ul class="collapse">
  <li><a href="#resampling" id="toc-resampling" class="nav-link" data-scroll-target="#resampling"><span class="header-section-number">10.5.1</span> Resampling</a></li>
  <li><a href="#cross-validation-1" id="toc-cross-validation-1" class="nav-link" data-scroll-target="#cross-validation-1"><span class="header-section-number">10.5.2</span> Cross validation</a></li>
  <li><a href="#example-cross-validation-workflow" id="toc-example-cross-validation-workflow" class="nav-link" data-scroll-target="#example-cross-validation-workflow"><span class="header-section-number">10.5.3</span> Example: Cross validation workflow</a></li>
  </ul></li>
  <li><a href="#model-evaluation-and-selection-in-r" id="toc-model-evaluation-and-selection-in-r" class="nav-link" data-scroll-target="#model-evaluation-and-selection-in-r"><span class="header-section-number">10.6</span> Model evaluation and selection in R</a>
  <ul class="collapse">
  <li><a href="#model-comparison-statistics-in-r" id="toc-model-comparison-statistics-in-r" class="nav-link" data-scroll-target="#model-comparison-statistics-in-r"><span class="header-section-number">10.6.1</span> Model comparison statistics in R</a></li>
  <li><a href="#stepwise-model-selection-in-r" id="toc-stepwise-model-selection-in-r" class="nav-link" data-scroll-target="#stepwise-model-selection-in-r"><span class="header-section-number">10.6.2</span> Stepwise model selection in R</a></li>
  <li><a href="#training-and-testing-sets-in-r" id="toc-training-and-testing-sets-in-r" class="nav-link" data-scroll-target="#training-and-testing-sets-in-r"><span class="header-section-number">10.6.3</span> Training and testing sets in R</a></li>
  <li><a href="#cross-validation-in-r" id="toc-cross-validation-in-r" class="nav-link" data-scroll-target="#cross-validation-in-r"><span class="header-section-number">10.6.4</span> Cross validation in R</a></li>
  </ul></li>
  <li><a href="#summary" id="toc-summary" class="nav-link" data-scroll-target="#summary"><span class="header-section-number">10.7</span> Summary</a></li>
  </ul>
<div class="toc-actions"><ul><li><a href="https://github.com/matackett/regression-book/issues/new" class="toc-action"><i class="bi bi-github"></i>Report an issue</a></li></ul></div></nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default"><nav class="quarto-page-breadcrumbs quarto-title-breadcrumbs d-none d-lg-block" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="./07-mlr.html">Part 3: Multiple linear regression</a></li><li class="breadcrumb-item"><a href="./10-model-eval.html"><span class="chapter-number">10</span>&nbsp; <span class="chapter-title">Model selection</span></a></li></ol></nav>
<div class="quarto-title">
<h1 class="title"><span id="sec-ch-model-eval" class="quarto-section-identifier"><span class="chapter-number">10</span>&nbsp; <span class="chapter-title">Model selection</span></span></h1>
</div>



<div class="quarto-title-meta">

    
  
    
  </div>
  


</header>


<section id="learning-goals" class="level2 unnumbered">
<h2 class="unnumbered anchored" data-anchor-id="learning-goals">Learning goals</h2>
<ul>
<li>Describe how model performance statistics are used to compare multiple models</li>
<li>Conduct model selection using stepwise procedures</li>
<li>Use cross-validation to compare models</li>
<li>Implement a model selection workflow using testing and training sets and cross validation</li>
<li>Implement a model selection workflow in R</li>
</ul>
<!--#
## Packages {.unnumbered}

-   `tidyverse` [@tidyverse]
-   `tidymodels` [@tidymodels-2]
-   `knitr` [@knitr]
-->
</section>
<section id="sec-spotify-intro" class="level2" data-number="10.1">
<h2 data-number="10.1" class="anchored" data-anchor-id="sec-spotify-intro"><span class="header-section-number">10.1</span> Introduction: Moody music</h2>
<p>There has long been an interest in the connection of music to our focus and well-being. A 2022 article in Harvard Health Online discusses the benefits of music therapy for patients undergoing treatment for health conditions <span class="citation" data-cites="kubicek2022musichealth">(<a href="references.html#ref-kubicek2022musichealth" role="doc-biblioref">Kubicek 2022</a>)</span>, and a 2024 study by researchers at the Institute for Healthcare Policy and Innovation at the University of Michigan found that listening to music was associated with lower stress, improved mood, and other benefits among adults age 50 - 80 years old <span class="citation" data-cites="howell2024soundmusic">(<a href="references.html#ref-howell2024soundmusic" role="doc-biblioref">Howell et al. 2024</a>)</span>. In April 2025, <em>The Guardian</em> published an article about the “flurry” of new books on the relationship between music and health and well-being <span class="citation" data-cites="macgregor2025moodmusic">(<a href="references.html#ref-macgregor2025moodmusic" role="doc-biblioref">MacGregor 2025</a>)</span>.</p>
<p>In addition to the influence of music in general, researchers have examined the impacts of songs that have different moods. For example, <span class="citation" data-cites="taruffi2017effects">Taruffi et al. (<a href="references.html#ref-taruffi2017effects" role="doc-biblioref">2017</a>)</span> found that sad music is associated with greater mind wandering and introspection compared to happy music. <span class="citation" data-cites="hew2020musicinduction">Campbell, Berezina, and Hew (<a href="references.html#ref-hew2020musicinduction" role="doc-biblioref">2020</a>)</span> concluded happy music is associated with positive affects describing increased energy, while sad music is associated with decreases in both positive and some negative affects.</p>
<p>Given the potential differences in music’s impact based on its mood, the analysis in this chapter focuses on understanding variability in the moods of songs based on a variety of musical features. In particular, the analysis aims to identify the musical features that are associated with how positive or negative the song is. Songs that are positive tend to have happy and cheerful sounds. In contrast, songs that are negative tend to have sad and more solemn or angry sounds. <!--# do i want to insert example songs? Could make them live links in the online version - ask publisher about permissions-->When listening to a song, we are not given a measure of how positive or negative a song is. Thus, by understanding the musical features associated with the song’s mood, we can more easily identify songs that align with the mood we wish to evoke.</p>
<p>We will analyze a data set containing the musical features and other information from 3000 songs that have appeared on Spotify (<a href="https://spotify.com">spotify.com</a>), a popular music streaming platform. The data is a subset of a data set curated and analyzed by data scientist Kaylin Pavlik in <span class="citation" data-cites="pavlik2019classifying">Pavlik (<a href="references.html#ref-pavlik2019classifying" role="doc-biblioref">2019</a>)</span>. It was featured as part of the TidyTuesday weekly data visualization challenge <span class="citation" data-cites="tidytuesday">(<a href="references.html#ref-tidytuesday" role="doc-biblioref">Community 2024</a>)</span> in January 2020. The data were originally collected from Spotify’s application programming interface (API) that allows uses to access data about the songs on the streaming platform. Because musical artists often define themselves by having a distinct sound, we would expect that multiple songs by the same artist could have similar features. To avoid potential issues from violations in the independence condition, we randomly sampled one song from artists who had multiple songs in the data. Thus, there is only one song for each artist in the data that is analyzed in this chapter.</p>
<p>The data are available in <code>spotify-songs-sample.csv</code>. The variables below will be used in the analysis. The definitions are adapted from Spotify Track’s Audio Features documentation <span class="citation" data-cites="SpotifyGetAudioFeatures">(<a href="references.html#ref-SpotifyGetAudioFeatures" role="doc-biblioref">Spotify for Developers n.d.</a>)</span>.</p>
<p>The response variable is <code>valence</code>, defined as the following:</p>
<blockquote class="blockquote">
<p>Measure ranging 0 to 1 that describes the song’s positiveness. Songs with high valence (values close to 1) sound more positive, and songs with lower valence (values close to 0). sound more negative. For example, a song that sounds happy and cheerful will have high valence, and a song that sounds sound or angry will have a low valence.</p>
</blockquote>
<p>The predictors are the following:</p>
<!--# removing Key & Instrumentalness & Speechiness from the analysis. Need to remove them from the data-->
<ul>
<li><p><code>playlist_genre</code>: Playlist genre <!--# need something more specific? --></p></li>
<li><p><code>danceability</code>: Measure ranging 0 to 1 that describes how well suited the song is for dancing. Songs with values close to 0 are the least danceable, and those with values close to 1 are the most danceable.</p></li>
<li><p><code>energy</code>: Measure ranging from 0 to 1 that describes the intensity and activity of a song. Songs with values close to 1 may feel fast, loud, and noisy, while songs with values close to 0 may feel quiet and slow.</p></li>
<li><p><code>loudness</code>: Measure typically ranging from -60 and 0 of the volume in decibels (dB). It is computed by averaging the volume across the entire song.</p></li>
<li><p><code>mode</code>: Description of the type of scale for the musical melody of a song. Possible values are “Major” and “Minor”.</p></li>
<li><p><code>acousticness</code>: Measure ranging from 0 to 1 of the confidence a song is acoustic. <!--# is there a better description here?--> Values close to 0 are low confidence the song is acoustic, and values close to 1 are high confidence the song is acoustic.</p></li>
<li><p><code>liveness</code>: Measure ranging from 0 to 1 detecting the presence of live audience in the song. Values close to 1 (0.8 or higher) indicate a strong likelihood the song track was recorded in front a live audience.</p></li>
<li><p><code>tempo</code>: Measure of the average pace of a song in beats per minute (BPM).</p></li>
<li><p><code>duration_min</code>: Length of a song in minutes</p></li>
</ul>
<div class="objective">
<p>The goal of this analysis is to explain variability in <code>valence</code> using other musical features. This model can be used for prediction, but the primary objective is explanation.</p>
</div>
<section id="exploratory-data-analysis" class="level3" data-number="10.1.1">
<h3 data-number="10.1.1" class="anchored" data-anchor-id="exploratory-data-analysis"><span class="header-section-number">10.1.1</span> Exploratory data analysis</h3>
<div class="cell" data-layout-nrow="4">
<div id="fig-spotify-univariate-eda" class="quarto-layout-panel">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-spotify-univariate-eda-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<div class="quarto-layout-row">
<div class="cell-output-display quarto-layout-cell-subref quarto-layout-cell" data-ref-parent="fig-spotify-univariate-eda" style="flex-basis: 33.3%;justify-content: flex-start;">
<div id="fig-spotify-univariate-eda-1" class="quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-subfloat-fig figure">
<div aria-describedby="fig-spotify-univariate-eda-1-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<a href="10-model-eval_files/figure-html/fig-spotify-univariate-eda-1.png" class="lightbox" data-gallery="fig-spotify-univariate-eda" title="Figure&nbsp;10.1&nbsp;(a): valence"><img src="10-model-eval_files/figure-html/fig-spotify-univariate-eda-1.png" class="img-fluid figure-img" style="width:100.0%" data-ref-parent="fig-spotify-univariate-eda"></a>
</div>
<figcaption class="quarto-float-caption-bottom quarto-subfloat-caption quarto-subfloat-fig" id="fig-spotify-univariate-eda-1-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
(a) <code>valence</code>
</figcaption>
</figure>
</div>
</div>
<div class="cell-output-display quarto-layout-cell-subref quarto-layout-cell" data-ref-parent="fig-spotify-univariate-eda" style="flex-basis: 33.3%;justify-content: flex-start;">
<div id="fig-spotify-univariate-eda-2" class="quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-subfloat-fig figure">
<div aria-describedby="fig-spotify-univariate-eda-2-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<a href="10-model-eval_files/figure-html/fig-spotify-univariate-eda-2.png" class="lightbox" data-gallery="fig-spotify-univariate-eda" title="Figure&nbsp;10.1&nbsp;(b): playlist_genre"><img src="10-model-eval_files/figure-html/fig-spotify-univariate-eda-2.png" class="img-fluid figure-img" style="width:100.0%" data-ref-parent="fig-spotify-univariate-eda"></a>
</div>
<figcaption class="quarto-float-caption-bottom quarto-subfloat-caption quarto-subfloat-fig" id="fig-spotify-univariate-eda-2-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
(b) <code>playlist_genre</code>
</figcaption>
</figure>
</div>
</div>
<div class="cell-output-display quarto-layout-cell-subref quarto-layout-cell" data-ref-parent="fig-spotify-univariate-eda" style="flex-basis: 33.3%;justify-content: flex-start;">
<div id="fig-spotify-univariate-eda-3" class="quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-subfloat-fig figure">
<div aria-describedby="fig-spotify-univariate-eda-3-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<a href="10-model-eval_files/figure-html/fig-spotify-univariate-eda-3.png" class="lightbox" data-gallery="fig-spotify-univariate-eda" title="Figure&nbsp;10.1&nbsp;(c): danceability"><img src="10-model-eval_files/figure-html/fig-spotify-univariate-eda-3.png" class="img-fluid figure-img" style="width:100.0%" data-ref-parent="fig-spotify-univariate-eda"></a>
</div>
<figcaption class="quarto-float-caption-bottom quarto-subfloat-caption quarto-subfloat-fig" id="fig-spotify-univariate-eda-3-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
(c) <code>danceability</code>
</figcaption>
</figure>
</div>
</div>
</div>
<div class="quarto-layout-row">
<div class="cell-output-display quarto-layout-cell-subref quarto-layout-cell" data-ref-parent="fig-spotify-univariate-eda" style="flex-basis: 33.3%;justify-content: flex-start;">
<div id="fig-spotify-univariate-eda-4" class="quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-subfloat-fig figure">
<div aria-describedby="fig-spotify-univariate-eda-4-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<a href="10-model-eval_files/figure-html/fig-spotify-univariate-eda-4.png" class="lightbox" data-gallery="fig-spotify-univariate-eda" title="Figure&nbsp;10.1&nbsp;(d): energy"><img src="10-model-eval_files/figure-html/fig-spotify-univariate-eda-4.png" class="img-fluid figure-img" style="width:100.0%" data-ref-parent="fig-spotify-univariate-eda"></a>
</div>
<figcaption class="quarto-float-caption-bottom quarto-subfloat-caption quarto-subfloat-fig" id="fig-spotify-univariate-eda-4-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
(d) <code>energy</code>
</figcaption>
</figure>
</div>
</div>
<div class="cell-output-display quarto-layout-cell-subref quarto-layout-cell" data-ref-parent="fig-spotify-univariate-eda" style="flex-basis: 33.3%;justify-content: flex-start;">
<div id="fig-spotify-univariate-eda-5" class="quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-subfloat-fig figure">
<div aria-describedby="fig-spotify-univariate-eda-5-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<a href="10-model-eval_files/figure-html/fig-spotify-univariate-eda-5.png" class="lightbox" data-gallery="fig-spotify-univariate-eda" title="Figure&nbsp;10.1&nbsp;(e): loudness"><img src="10-model-eval_files/figure-html/fig-spotify-univariate-eda-5.png" class="img-fluid figure-img" style="width:100.0%" data-ref-parent="fig-spotify-univariate-eda"></a>
</div>
<figcaption class="quarto-float-caption-bottom quarto-subfloat-caption quarto-subfloat-fig" id="fig-spotify-univariate-eda-5-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
(e) <code>loudness</code>
</figcaption>
</figure>
</div>
</div>
<div class="cell-output-display quarto-layout-cell-subref quarto-layout-cell" data-ref-parent="fig-spotify-univariate-eda" style="flex-basis: 33.3%;justify-content: flex-start;">
<div id="fig-spotify-univariate-eda-6" class="quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-subfloat-fig figure">
<div aria-describedby="fig-spotify-univariate-eda-6-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<a href="10-model-eval_files/figure-html/fig-spotify-univariate-eda-6.png" class="lightbox" data-gallery="fig-spotify-univariate-eda" title="Figure&nbsp;10.1&nbsp;(f): mode"><img src="10-model-eval_files/figure-html/fig-spotify-univariate-eda-6.png" class="img-fluid figure-img" style="width:100.0%" data-ref-parent="fig-spotify-univariate-eda"></a>
</div>
<figcaption class="quarto-float-caption-bottom quarto-subfloat-caption quarto-subfloat-fig" id="fig-spotify-univariate-eda-6-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
(f) <code>mode</code>
</figcaption>
</figure>
</div>
</div>
</div>
<div class="quarto-layout-row">
<div class="cell-output-display quarto-layout-cell-subref quarto-layout-cell" data-ref-parent="fig-spotify-univariate-eda" style="flex-basis: 33.3%;justify-content: flex-start;">
<div id="fig-spotify-univariate-eda-7" class="quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-subfloat-fig figure">
<div aria-describedby="fig-spotify-univariate-eda-7-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<a href="10-model-eval_files/figure-html/fig-spotify-univariate-eda-7.png" class="lightbox" data-gallery="fig-spotify-univariate-eda" title="Figure&nbsp;10.1&nbsp;(g): acousticness"><img src="10-model-eval_files/figure-html/fig-spotify-univariate-eda-7.png" class="img-fluid figure-img" style="width:100.0%" data-ref-parent="fig-spotify-univariate-eda"></a>
</div>
<figcaption class="quarto-float-caption-bottom quarto-subfloat-caption quarto-subfloat-fig" id="fig-spotify-univariate-eda-7-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
(g) <code>acousticness</code>
</figcaption>
</figure>
</div>
</div>
<div class="cell-output-display quarto-layout-cell-subref quarto-layout-cell" data-ref-parent="fig-spotify-univariate-eda" style="flex-basis: 33.3%;justify-content: flex-start;">
<div id="fig-spotify-univariate-eda-8" class="quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-subfloat-fig figure">
<div aria-describedby="fig-spotify-univariate-eda-8-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<a href="10-model-eval_files/figure-html/fig-spotify-univariate-eda-8.png" class="lightbox" data-gallery="fig-spotify-univariate-eda" title="Figure&nbsp;10.1&nbsp;(h): liveness"><img src="10-model-eval_files/figure-html/fig-spotify-univariate-eda-8.png" class="img-fluid figure-img" style="width:100.0%" data-ref-parent="fig-spotify-univariate-eda"></a>
</div>
<figcaption class="quarto-float-caption-bottom quarto-subfloat-caption quarto-subfloat-fig" id="fig-spotify-univariate-eda-8-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
(h) <code>liveness</code>
</figcaption>
</figure>
</div>
</div>
<div class="cell-output-display quarto-layout-cell-subref quarto-layout-cell" data-ref-parent="fig-spotify-univariate-eda" style="flex-basis: 33.3%;justify-content: flex-start;">
<div id="fig-spotify-univariate-eda-9" class="quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-subfloat-fig figure">
<div aria-describedby="fig-spotify-univariate-eda-9-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<a href="10-model-eval_files/figure-html/fig-spotify-univariate-eda-9.png" class="lightbox" data-gallery="fig-spotify-univariate-eda" title="Figure&nbsp;10.1&nbsp;(i): tempo"><img src="10-model-eval_files/figure-html/fig-spotify-univariate-eda-9.png" class="img-fluid figure-img" style="width:100.0%" data-ref-parent="fig-spotify-univariate-eda"></a>
</div>
<figcaption class="quarto-float-caption-bottom quarto-subfloat-caption quarto-subfloat-fig" id="fig-spotify-univariate-eda-9-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
(i) <code>tempo</code>
</figcaption>
</figure>
</div>
</div>
</div>
<div class="quarto-layout-row">
<div class="cell-output-display quarto-layout-cell-subref quarto-layout-cell" data-ref-parent="fig-spotify-univariate-eda" style="flex-basis: 33.3%;justify-content: flex-start;">
<div id="fig-spotify-univariate-eda-10" class="quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-subfloat-fig figure">
<div aria-describedby="fig-spotify-univariate-eda-10-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<a href="10-model-eval_files/figure-html/fig-spotify-univariate-eda-10.png" class="lightbox" data-gallery="fig-spotify-univariate-eda" title="Figure&nbsp;10.1&nbsp;(j): duration_min"><img src="10-model-eval_files/figure-html/fig-spotify-univariate-eda-10.png" class="img-fluid figure-img" style="width:100.0%" data-ref-parent="fig-spotify-univariate-eda"></a>
</div>
<figcaption class="quarto-float-caption-bottom quarto-subfloat-caption quarto-subfloat-fig" id="fig-spotify-univariate-eda-10-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
(j) <code>duration_min</code>
</figcaption>
</figure>
</div>
</div>
</div>
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-spotify-univariate-eda-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;10.1: Univariate exploratory data analysis for Spotify data
</figcaption>
</figure>
</div>
</div>
<p><a href="#fig-spotify-univariate-eda-1" class="quarto-xref">Figure&nbsp;<span>10.1 (a)</span></a> shows the distribution of the response variable <code>valence</code>. The distribution is unimodal and approximately symmetric with many songs having values of valence around 0.5 (perhaps indicating a more neutral mood to the song). There is one song that has almost a completely negative mood (<code>valence =</code> 10^{-5}), and one song with an almost completely positive mood (<code>valence =</code> 0.991).</p>
<p>It is worth noting that <code>valence</code> is bounded between 0 and 1, meaning it is not valid to obtain values of valence outside that range. This is not much concern for the purposes of this analysis, because the purpose is primarily explanation. If we intend to build a model whose primary purpose is prediction, then we should more carefully examine any issues and potential transformations for the bounded response variable.</p>
<p>Given the number of potential predictors, we’ll leave observations about the distributions of the predictor variables to the reader.</p>
<div class="cell" data-layout-nrow="4">
<div id="fig-spotify-bivariate-eda" class="quarto-layout-panel">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-spotify-bivariate-eda-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<div class="quarto-layout-row">
<div class="cell-output-display quarto-layout-cell-subref quarto-layout-cell" data-ref-parent="fig-spotify-bivariate-eda" style="flex-basis: 33.3%;justify-content: flex-start;">
<div id="fig-spotify-bivariate-eda-1" class="quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-subfloat-fig figure">
<div aria-describedby="fig-spotify-bivariate-eda-1-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<a href="10-model-eval_files/figure-html/fig-spotify-bivariate-eda-1.png" class="lightbox" data-gallery="fig-spotify-bivariate-eda" title="Figure&nbsp;10.2&nbsp;(a): valence vs.&nbsp;playlist_genre"><img src="10-model-eval_files/figure-html/fig-spotify-bivariate-eda-1.png" class="img-fluid figure-img" style="width:100.0%" data-ref-parent="fig-spotify-bivariate-eda"></a>
</div>
<figcaption class="quarto-float-caption-bottom quarto-subfloat-caption quarto-subfloat-fig" id="fig-spotify-bivariate-eda-1-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
(a) <code>valence</code> vs.&nbsp;<code>playlist_genre</code>
</figcaption>
</figure>
</div>
</div>
<div class="cell-output-display quarto-layout-cell-subref quarto-layout-cell" data-ref-parent="fig-spotify-bivariate-eda" style="flex-basis: 33.3%;justify-content: flex-start;">
<div id="fig-spotify-bivariate-eda-2" class="quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-subfloat-fig figure">
<div aria-describedby="fig-spotify-bivariate-eda-2-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<a href="10-model-eval_files/figure-html/fig-spotify-bivariate-eda-2.png" class="lightbox" data-gallery="fig-spotify-bivariate-eda" title="Figure&nbsp;10.2&nbsp;(b): valence vs.&nbsp;danceability"><img src="10-model-eval_files/figure-html/fig-spotify-bivariate-eda-2.png" class="img-fluid figure-img" style="width:100.0%" data-ref-parent="fig-spotify-bivariate-eda"></a>
</div>
<figcaption class="quarto-float-caption-bottom quarto-subfloat-caption quarto-subfloat-fig" id="fig-spotify-bivariate-eda-2-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
(b) <code>valence</code> vs.&nbsp;<code>danceability</code>
</figcaption>
</figure>
</div>
</div>
<div class="cell-output-display quarto-layout-cell-subref quarto-layout-cell" data-ref-parent="fig-spotify-bivariate-eda" style="flex-basis: 33.3%;justify-content: flex-start;">
<div id="fig-spotify-bivariate-eda-3" class="quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-subfloat-fig figure">
<div aria-describedby="fig-spotify-bivariate-eda-3-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<a href="10-model-eval_files/figure-html/fig-spotify-bivariate-eda-3.png" class="lightbox" data-gallery="fig-spotify-bivariate-eda" title="Figure&nbsp;10.2&nbsp;(c): valence vs.&nbsp;energy"><img src="10-model-eval_files/figure-html/fig-spotify-bivariate-eda-3.png" class="img-fluid figure-img" style="width:100.0%" data-ref-parent="fig-spotify-bivariate-eda"></a>
</div>
<figcaption class="quarto-float-caption-bottom quarto-subfloat-caption quarto-subfloat-fig" id="fig-spotify-bivariate-eda-3-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
(c) <code>valence</code> vs.&nbsp;<code>energy</code>
</figcaption>
</figure>
</div>
</div>
</div>
<div class="quarto-layout-row">
<div class="cell-output-display quarto-layout-cell-subref quarto-layout-cell" data-ref-parent="fig-spotify-bivariate-eda" style="flex-basis: 33.3%;justify-content: flex-start;">
<div id="fig-spotify-bivariate-eda-4" class="quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-subfloat-fig figure">
<div aria-describedby="fig-spotify-bivariate-eda-4-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<a href="10-model-eval_files/figure-html/fig-spotify-bivariate-eda-4.png" class="lightbox" data-gallery="fig-spotify-bivariate-eda" title="Figure&nbsp;10.2&nbsp;(d): valence vs.&nbsp;loudness"><img src="10-model-eval_files/figure-html/fig-spotify-bivariate-eda-4.png" class="img-fluid figure-img" style="width:100.0%" data-ref-parent="fig-spotify-bivariate-eda"></a>
</div>
<figcaption class="quarto-float-caption-bottom quarto-subfloat-caption quarto-subfloat-fig" id="fig-spotify-bivariate-eda-4-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
(d) <code>valence</code> vs.&nbsp;<code>loudness</code>
</figcaption>
</figure>
</div>
</div>
<div class="cell-output-display quarto-layout-cell-subref quarto-layout-cell" data-ref-parent="fig-spotify-bivariate-eda" style="flex-basis: 33.3%;justify-content: flex-start;">
<div id="fig-spotify-bivariate-eda-5" class="quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-subfloat-fig figure">
<div aria-describedby="fig-spotify-bivariate-eda-5-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<a href="10-model-eval_files/figure-html/fig-spotify-bivariate-eda-5.png" class="lightbox" data-gallery="fig-spotify-bivariate-eda" title="Figure&nbsp;10.2&nbsp;(e): valence vs.&nbsp;mode"><img src="10-model-eval_files/figure-html/fig-spotify-bivariate-eda-5.png" class="img-fluid figure-img" style="width:100.0%" data-ref-parent="fig-spotify-bivariate-eda"></a>
</div>
<figcaption class="quarto-float-caption-bottom quarto-subfloat-caption quarto-subfloat-fig" id="fig-spotify-bivariate-eda-5-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
(e) <code>valence</code> vs.&nbsp;<code>mode</code>
</figcaption>
</figure>
</div>
</div>
<div class="cell-output-display quarto-layout-cell-subref quarto-layout-cell" data-ref-parent="fig-spotify-bivariate-eda" style="flex-basis: 33.3%;justify-content: flex-start;">
<div id="fig-spotify-bivariate-eda-6" class="quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-subfloat-fig figure">
<div aria-describedby="fig-spotify-bivariate-eda-6-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<a href="10-model-eval_files/figure-html/fig-spotify-bivariate-eda-6.png" class="lightbox" data-gallery="fig-spotify-bivariate-eda" title="Figure&nbsp;10.2&nbsp;(f): valence vs.&nbsp;acousticness"><img src="10-model-eval_files/figure-html/fig-spotify-bivariate-eda-6.png" class="img-fluid figure-img" style="width:100.0%" data-ref-parent="fig-spotify-bivariate-eda"></a>
</div>
<figcaption class="quarto-float-caption-bottom quarto-subfloat-caption quarto-subfloat-fig" id="fig-spotify-bivariate-eda-6-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
(f) <code>valence</code> vs.&nbsp;<code>acousticness</code>
</figcaption>
</figure>
</div>
</div>
</div>
<div class="quarto-layout-row">
<div class="cell-output-display quarto-layout-cell-subref quarto-layout-cell" data-ref-parent="fig-spotify-bivariate-eda" style="flex-basis: 33.3%;justify-content: flex-start;">
<div id="fig-spotify-bivariate-eda-7" class="quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-subfloat-fig figure">
<div aria-describedby="fig-spotify-bivariate-eda-7-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<a href="10-model-eval_files/figure-html/fig-spotify-bivariate-eda-7.png" class="lightbox" data-gallery="fig-spotify-bivariate-eda" title="Figure&nbsp;10.2&nbsp;(g): valence vs.&nbsp;instrumentalness"><img src="10-model-eval_files/figure-html/fig-spotify-bivariate-eda-7.png" class="img-fluid figure-img" style="width:100.0%" data-ref-parent="fig-spotify-bivariate-eda"></a>
</div>
<figcaption class="quarto-float-caption-bottom quarto-subfloat-caption quarto-subfloat-fig" id="fig-spotify-bivariate-eda-7-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
(g) <code>valence</code> vs.&nbsp;<code>instrumentalness</code>
</figcaption>
</figure>
</div>
</div>
<div class="cell-output-display quarto-layout-cell-subref quarto-layout-cell" data-ref-parent="fig-spotify-bivariate-eda" style="flex-basis: 33.3%;justify-content: flex-start;">
<div id="fig-spotify-bivariate-eda-8" class="quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-subfloat-fig figure">
<div aria-describedby="fig-spotify-bivariate-eda-8-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<a href="10-model-eval_files/figure-html/fig-spotify-bivariate-eda-8.png" class="lightbox" data-gallery="fig-spotify-bivariate-eda" title="Figure&nbsp;10.2&nbsp;(h): valence vs.&nbsp;liveness"><img src="10-model-eval_files/figure-html/fig-spotify-bivariate-eda-8.png" class="img-fluid figure-img" style="width:100.0%" data-ref-parent="fig-spotify-bivariate-eda"></a>
</div>
<figcaption class="quarto-float-caption-bottom quarto-subfloat-caption quarto-subfloat-fig" id="fig-spotify-bivariate-eda-8-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
(h) <code>valence</code> vs.&nbsp;<code>liveness</code>
</figcaption>
</figure>
</div>
</div>
<div class="cell-output-display quarto-layout-cell-subref quarto-layout-cell" data-ref-parent="fig-spotify-bivariate-eda" style="flex-basis: 33.3%;justify-content: flex-start;">
<div id="fig-spotify-bivariate-eda-9" class="quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-subfloat-fig figure">
<div aria-describedby="fig-spotify-bivariate-eda-9-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<a href="10-model-eval_files/figure-html/fig-spotify-bivariate-eda-9.png" class="lightbox" data-gallery="fig-spotify-bivariate-eda" title="Figure&nbsp;10.2&nbsp;(i): valence vs.&nbsp;tempo"><img src="10-model-eval_files/figure-html/fig-spotify-bivariate-eda-9.png" class="img-fluid figure-img" style="width:100.0%" data-ref-parent="fig-spotify-bivariate-eda"></a>
</div>
<figcaption class="quarto-float-caption-bottom quarto-subfloat-caption quarto-subfloat-fig" id="fig-spotify-bivariate-eda-9-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
(i) <code>valence</code> vs.&nbsp;<code>tempo</code>
</figcaption>
</figure>
</div>
</div>
</div>
<div class="quarto-layout-row">
<div class="cell-output-display quarto-layout-cell-subref quarto-layout-cell" data-ref-parent="fig-spotify-bivariate-eda" style="flex-basis: 33.3%;justify-content: flex-start;">
<div id="fig-spotify-bivariate-eda-10" class="quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-subfloat-fig figure">
<div aria-describedby="fig-spotify-bivariate-eda-10-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<a href="10-model-eval_files/figure-html/fig-spotify-bivariate-eda-10.png" class="lightbox" data-gallery="fig-spotify-bivariate-eda" title="Figure&nbsp;10.2&nbsp;(j): valence vs.&nbsp;duration"><img src="10-model-eval_files/figure-html/fig-spotify-bivariate-eda-10.png" class="img-fluid figure-img" style="width:100.0%" data-ref-parent="fig-spotify-bivariate-eda"></a>
</div>
<figcaption class="quarto-float-caption-bottom quarto-subfloat-caption quarto-subfloat-fig" id="fig-spotify-bivariate-eda-10-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
(j) <code>valence</code> vs.&nbsp;<code>duration</code>
</figcaption>
</figure>
</div>
</div>
</div>
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-spotify-bivariate-eda-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;10.2: Bivariate exploratory data analysis for Spotify data. In each plot, the predictor is on the x-axis and the response, <code>valence</code> is on the y-axis.
</figcaption>
</figure>
</div>
</div>
<div class="yourturn">
<p>Based on <a href="#fig-spotify-bivariate-eda" class="quarto-xref">Figure&nbsp;<span>10.2</span></a>, which variable(s) do you think have an association with a song’s valence? Describe the direction of the relationship(s).<a href="#fn1" class="footnote-ref" id="fnref1" role="doc-noteref"><sup>1</sup></a></p>
</div>
<p><a href="#fig-spotify-bivariate-eda" class="quarto-xref">Figure&nbsp;<span>10.2</span></a> shows the plots for the bivariate exploratory data analysis. In general, it is more challenging than earlier analyses to see relationships between the valence and the musical features from the bivariate plots. This could be because these features are not actually associated with the valence, or the relationships result from a combination of features rather than individual relationships between each feature and the response. As with previous analyses, the exploratory data analysis is helpful for providing initial intuition about the data and analysis results, but it cannot be used to draw final conclusions. Thus, we choose a model to be used for interpretation and conclusions based on model fit and performance statistics.</p>
<p>In <a href="09-mlr-transformations.html#sec-transform-choose-model" class="quarto-xref"><span>Section 9.5</span></a>, we compared multiple models to determine which one was the best fit for the data. In these instances, we were comparing models that had the same variables but differed in whether transformations were applied to the response or predictors or whether interactions or higher-order terms were included. Often, however, we do not know which variables to include in the final model and need a way to choose from a set of potential predictors.</p>
<div class="analysis_in_practice">
<p>When building a regression model, we aim to select the most <strong>parsimonious</strong> (the simplest) model possible. This means choosing the model with the fewest predictors, interaction terms, and transformations that still effectively summarizes the relationship between the response and predictor variables. <!--# see from feedback if I need further explanation about why--></p>
</div>
</section>
</section>
<section id="sec-model-compare-stats" class="level2" data-number="10.2">
<h2 data-number="10.2" class="anchored" data-anchor-id="sec-model-compare-stats"><span class="header-section-number">10.2</span> Statistics for model comparison</h2>
<!--# or call this section "statistics for model comparison"-->
<p>We begin by discussing model fit and performance statistics used to compare models in the model selection process. In <a href="04-slr.html#sec-model-assessment" class="quarto-xref"><span>Section 4.7</span></a>, we introduced <span class="math inline">\(R^2\)</span> and RMSE in to evaluate model fit and predictive performance of regression models. In this section, we introduce new statistics Adjusted <span class="math inline">\(R^2\)</span>, AIC, and BIC, that are also used to compare models. In practice, we often use multiple statistics for model comparison, and sometimes these statistics can suggest we choose different models. Throughout the chapter, we will demonstrate how the analysis objective helps us determine which statistics to prioritize when doing model selection.</p>
<section id="sec-adj-rsq" class="level3" data-number="10.2.1">
<h3 data-number="10.2.1" class="anchored" data-anchor-id="sec-adj-rsq"><span class="header-section-number">10.2.1</span> Adjusted <span class="math inline">\(R^2\)</span></h3>
<p>Recall from <a href="04-slr.html#sec-model-assessment" class="quarto-xref"><span>Section 4.7</span></a> that <span class="math inline">\(R^2\)</span> is the proportion of variability in the response variable that is explained by the model. This value is based on the process Analysis of Variance (ANOVA), in which the variability in the response variable is decomposed into variability that can be explained by the model and variability left unexplained in the residuals. Thus, <span class="math inline">\(R^2\)</span> is computed as</p>
<p><span id="eq-rsq"><span class="math display">\[
R^2 = \frac{SSM}{SST} = 1 - \frac{SSR}{SST}
\tag{10.1}\]</span></span></p>
<p>where <span class="math inline">\(SSM\)</span> is the model sum of squares (explained variability), <span class="math inline">\(SSR\)</span> is the residual sum of squares (unexplained variability), and <span class="math inline">\(SST\)</span> is the total variability in the response variable.</p>
<p>Thus far, we have used <span class="math inline">\(R^2\)</span> to describe how well a model fits the data and to compare two models with the same number of predictors (for example, in <a href="09-mlr-transformations.html#sec-transform-choose-model" class="quarto-xref"><span>Section 9.5</span></a>). Now as we prepare to do model selection, we will often be comparing models that have different numbers of predictor variables, since the model selection process is often us answering the question “should we include predictor <span class="math inline">\(X_j\)</span> in the model given the other predictors currently in the model?”. Recall from <a href="07-mlr.html#sec-mlr-estimate-coef" class="quarto-xref"><span>Section 7.3</span></a> that the coefficients for a least-squares regression model are the ones that minimize the sum of square residuals (<span class="math inline">\(SSR\)</span>). Thus, if we estimate non-zero coefficients for new predictors, <span class="math inline">\(SSR\)</span> will decrease (even if it’s just by a very small amount) by definition. Thus, we cannot use <span class="math inline">\(R^2\)</span> to compare models with different numbers of predictors, because <span class="math inline">\(R^2\)</span> tends to preference the model with more predictors. This can lead to <strong>overfitting</strong>, the case in which a model fits so closely to the sample data that it cannot be reliably used on new data.</p>
<p>When comparing models with different numbers of predictors, we can use a related statistic, called Adjusted<span class="math inline">\(R^2\)</span> that takes into account the number of predictor variables in the model.</p>
<p>The formula for Adjusted <span class="math inline">\(R^2\)</span> is</p>
<p><span id="eq-adj-rsq"><span class="math display">\[
\text{Adjusted }R^2 = 1 - \frac{SSR / (n - p - 1)}{SST / (n - 1)}
\tag{10.2}\]</span></span></p>
<p>where <span class="math inline">\(SSR\)</span> and <span class="math inline">\(SST\)</span> are defined as before, <span class="math inline">\(n\)</span> is the number of observations in the data, and <span class="math inline">\(p\)</span> is the number of predictors.</p>
<p>The numerator <span class="math inline">\(SSR / (n - p - 1)\)</span>, the residual sum of squares divided by the associated degrees of freedom, is a measure of the average variability about the regression line. We showed in <a href="08-mlr-inference.html#sec-mlr-inf-foundation" class="quarto-xref"><span>Section 8.4.1</span></a> that the regression standard error, <span class="math inline">\(\hat{\sigma} = \sqrt{\frac{SSR}{n - p -1}}\)</span>, is the square root of this value. The variability about the regression line will be smaller for models that are a better fit for the data. Thus, <span class="math inline">\(SSR / (n - p - 1)\)</span> will decrease only if adding new predictors makes the model a better fit for the data.</p>
<p>The denominator, <span class="math inline">\(SST/(n-1)\)</span>, is the sum of squares total divided by the associated degrees of freedom. This is the variance of the response variable, <span class="math inline">\(s^2_{Y}\)</span> . It will remain the same for all candidate models, because the same sample data is used throughout the analysis.</p>
<p>Putting what we know about the numerator and denominator together, the second term in the <a href="#eq-adj-rsq" class="quarto-xref">Equation&nbsp;<span>10.2</span></a> is smaller for models that better fit the data. Therefore, the Adjusted <span class="math inline">\(R^2\)</span> will be greater for models that are a better fit. Adjusted <span class="math inline">\(R^2\)</span> ranges from 0 to 1, so we choose models that have values close to 1.</p>
<div class="math_rules">
<p>The <strong>degrees of freedom (df)</strong> are the number of observations available to understand variability.</p>
<p>When we fit a regression line with <span class="math inline">\(p\)</span> predictors, we need a minimum of <span class="math inline">\(p + 1\)</span> observations to fit the line, where <span class="math inline">\(p+1\)</span> is the number of terms in the model (including the intercept). We are left with <span class="math inline">\(n - (p + 1) = n - p - 1\)</span> observations to understand any variability in the residuals about the line. Thus, the degrees of freedom associated with SSR is <span class="math inline">\(n -  p - 1\)</span>.</p>
<p><br></p>
<p>The degrees of freedom associated with <span class="math inline">\(SST\)</span> are the number of observations needed to understand variability about the mean of the distribution of the response variable. We need a minimum of one observation to compute a mean, so we are left with <span class="math inline">\(n - 1\)</span> observations to understand variability about the mean.</p>
</div>
<p>Let’s look at an example of two candidate models to explain a song’s valence. The first model includes the predictor <code>danceability</code>, and the second model includes the predictors <code>danceability</code>, <code>mode</code>, and <code>liveness</code>.</p>
<div class="cell">
<div id="tbl-rsq-adjrsq-compare" class="cell quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-float-tbl figure">
<figcaption class="quarto-float-caption-top quarto-float-caption quarto-float-tbl" id="tbl-rsq-adjrsq-compare-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Table&nbsp;10.1: Comparing <span class="math inline">\(R^2\)</span> and Adjusted <span class="math inline">\(R^2\)</span> for two models for <code>valence</code>
</figcaption>
<div aria-describedby="tbl-rsq-adjrsq-compare-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<div class="cell-output-display">
<table class="do-not-create-environment cell caption-top table table-sm table-striped small">
<thead>
<tr class="header">
<th style="text-align: left;">Model</th>
<th style="text-align: right;">R-sq</th>
<th style="text-align: right;">Adj. R-sq</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">Danceability</td>
<td style="text-align: right;">0.0957</td>
<td style="text-align: right;">0.0954</td>
</tr>
<tr class="even">
<td style="text-align: left;">Danceability, Mode, Liveness</td>
<td style="text-align: right;">0.0960</td>
<td style="text-align: right;">0.0951</td>
</tr>
</tbody>
</table>
</div>
</div>
</figure>
</div>
</div>
<p>From <a href="#tbl-rsq-adjrsq-compare" class="quarto-xref">Table&nbsp;<span>10.1</span></a>, we see the model fits are very similar. Though <span class="math inline">\(R^2\)</span> is slightly higher for the model with the additional predictors <code>mode</code> and <code>liveness</code>, Adj. <span class="math inline">\(R^2\)</span> is higher for the model that only includes <code>danceability</code> . This means that adding <code>mode</code> and <code>liveness</code> to the model dose not explain much additional variability in a song’s valence after accounting for <code>danceability</code>. Thus, we might prefer the model that only contains <code>danceability</code> given the goal of choosing of the simplest model possible that is still effective.</p>
<div class="analysis_in_practice">
<p>Below are guidelines for using <span class="math inline">\(R^2\)</span> and Adjusted <span class="math inline">\(R^2\)</span> in practice.</p>
<p><span class="math inline">\(R^2\)</span></p>
<ul>
<li>Use to describe the proportion of variability in the response that is explained by the model.</li>
<li>Do <u><strong>not</strong></u> use to compare models with different numbers of predictors.</li>
</ul>
<p><strong>Adjusted</strong> <span class="math inline">\(R^2\)</span></p>
<ul>
<li>Use for model selection and to compare models with different numbers of predictors.</li>
<li>Do <u><strong>not</strong></u> use as a direct interpretation of the proportion of variability in the response that is explained by the model.</li>
</ul>
</div>
</section>
<section id="root-mean-square-error-rmse" class="level3" data-number="10.2.2">
<h3 data-number="10.2.2" class="anchored" data-anchor-id="root-mean-square-error-rmse"><span class="header-section-number">10.2.2</span> Root Mean Square Error (RMSE)</h3>
<p>Another statistic for model comparison is the Root Mean Square Error introduced in <a href="04-slr.html#sec-model-assessment" class="quarto-xref"><span>Section 4.7</span></a>. The <strong>Root Mean Square Error (RMSE)</strong> is a measure of the average error in the model predictions. From <a href="#eq-rmse" class="quarto-xref">Equation&nbsp;<span>10.3</span></a>, we can see it is very similar to <span class="math inline">\(\hat{\sigma}\)</span> (<a href="08-mlr-inference.html#eq-mlr-sigma" class="quarto-xref">Equation&nbsp;<span>8.3</span></a>). In fact, the difference between these values is negligible when the number of observations, <span class="math inline">\(n\)</span>, is large.</p>
<p><span id="eq-rmse"><span class="math display">\[
RMSE = \sqrt{\frac{\sum_{i=1}^n(y_i - \hat{y}_i)^2}{n}} = \sqrt{\frac{SSR}{n}}
\tag{10.3}\]</span></span></p>
<p>The RMSE is typically used over other model comparison statistics, such as Adjusted <span class="math inline">\(R^2\)</span>, when the primary modeling objective is prediction.</p>
<div class="yourturn">
<p>We use RMSE to compare two models. In general, do we select the model with the higher or lower value of RMSE?<a href="#fn2" class="footnote-ref" id="fnref2" role="doc-noteref"><sup>2</sup></a></p>
</div>
<p><a href="#tbl-rmse-compare" class="quarto-xref">Table&nbsp;<span>10.2</span></a> shows the RMSE for the two models compared in <a href="#sec-adj-rsq" class="quarto-xref"><span>Section 10.2.1</span></a>.</p>
<div class="cell">
<div id="tbl-rmse-compare" class="cell quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-float-tbl figure">
<figcaption class="quarto-float-caption-top quarto-float-caption quarto-float-tbl" id="tbl-rmse-compare-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Table&nbsp;10.2: RMSE for two candidate models of valence
</figcaption>
<div aria-describedby="tbl-rmse-compare-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<div class="cell-output-display">
<table class="do-not-create-environment cell caption-top table table-sm table-striped small">
<thead>
<tr class="header">
<th style="text-align: left;">Model</th>
<th style="text-align: right;">RMSE</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">Danceability</td>
<td style="text-align: right;">0.225</td>
</tr>
<tr class="even">
<td style="text-align: left;">Danceability, Mode, Liveness</td>
<td style="text-align: right;">0.225</td>
</tr>
</tbody>
</table>
</div>
</div>
</figure>
</div>
</div>
<p>Recall that RMSE has the same units and scale as the response variable, so we take these into consideration when interpreting RMSE and using it to compare models. Based on <a href="#tbl-rmse-compare" class="quarto-xref">Table&nbsp;<span>10.2</span></a>, the values of RMSE for the two models are equal down to three digits. From <a href="#sec-spotify-intro" class="quarto-xref"><span>Section 10.1</span></a>, <code>valence</code> takes values 0 to 1, so a difference less than 0.001 in the prediction error is very small. This is consistent with the very small difference in Adjusted <span class="math inline">\(R^2\)</span> values in <a href="#tbl-rsq-adjrsq-compare" class="quarto-xref">Table&nbsp;<span>10.1</span></a>. In general, we select the model that has the smallest value of RMSE; however, in cases like this with negligible to no difference between the two models, we use our judgment as the data scientist, along with subject matter expertise and the analysis objectives to choose a model.</p>
</section>
<section id="sec-aic-bic" class="level3" data-number="10.2.3">
<h3 data-number="10.2.3" class="anchored" data-anchor-id="sec-aic-bic"><span class="header-section-number">10.2.3</span> AIC and BIC</h3>
<p>Adjusted <span class="math inline">\(R^2\)</span> and RMSE are computed by quantifying the variability in the residuals (the unexplained variability). In addition to these statistics are two other statistics, AIC and BIC, that are based on another measure of model fit called a likelihood function. We will talk about the likelihood in more detail in <a href="11-logistic.html" class="quarto-xref"><span>Chapter 11</span></a>, but in short, a <strong>likelihood function</strong> quantifies how plausible it is to obtain the observed data given a particular model is the true model of the relationship between the response and predictor variables. <!--# need less clunky definiiton--> Models with higher values for the likelihood are a better fit for the data compared to models with lower values. It is common to work with the natural log of the likelihood function, denoted <span class="math inline">\(\log L\)</span>, for ease of calculations. The natural log is monotonic, so higher values of <span class="math inline">\(\log L\)</span> correspond to higher values of the likelihood and vice versa.</p>
<p>The <strong>Akaike’s Information Criterion (AIC)</strong> <span class="citation" data-cites="akaike1974">(<a href="references.html#ref-akaike1974" role="doc-biblioref">Akaike 1974</a>)</span> and <strong>Schwarz’s Bayesian Information Criterion (BIC)</strong> <span class="citation" data-cites="schwarz1978estimating">(<a href="references.html#ref-schwarz1978estimating" role="doc-biblioref">Schwarz 1978</a>)</span> are two measures of model fit based on the likelihood. Their equations are</p>
<p><span id="eq-aic-bic"><span class="math display">\[
\begin{aligned}
AIC &amp;= -2\log L + 2(p+1) \\
BIC &amp;= -2\log L + \log(n)(p+1)
\end{aligned}
\tag{10.4}\]</span></span></p>
<p>where <span class="math inline">\(\log L\)</span> is the log-likelihood, <span class="math inline">\(n\)</span> is the number of observations, and <span class="math inline">\(p+1\)</span> is the number of terms in the model.</p>
<p>In <a href="#eq-aic-bic" class="quarto-xref">Equation&nbsp;<span>10.4</span></a>, the first term for both AIC and BIC is <span class="math inline">\(-2 \log L\)</span>. Because the log-likelihood is greater for better fitting models, this term decreases as the model fit improves. The second term in each equation is the “penalty” for the number of predictors in the model. As new predictors are added to a model, AIC and BIC are a balance between the decreasing first term and increasing second term. Where AIC and BIC differ is on the strength of the penalty for the number of terms in the model. When <span class="math inline">\(n &gt; 8\)</span> (essentially all the time!), <span class="math inline">\(\log(n)(p+1) &gt; 2(p + 1)\)</span>, so we say BIC has the “stronger penalty”. This results in BIC tending to preference models with fewer predictor variables than AIC.</p>
<p>The AIC and BIC for a single model is generally not meaningful in practice, so these values are used to compare two or more models. Small values of AIC and BIC correspond to better model fit, so we select the model that minimizes these statistics when comparing multiple models. In practice, a difference of 10 or greater in the AIC or BIC between models, is considered meaningful enough to choose one model over the other. <a href="#tbl-aic-bic-guidelines" class="quarto-xref">Table&nbsp;<span>10.3</span></a> provides more specific guidelines for model comparison based on the differences in AIC and BIC.</p>
<div id="tbl-aic-bic-guidelines" class="quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-float-tbl figure">
<figcaption class="quarto-float-caption-top quarto-float-caption quarto-float-tbl" id="tbl-aic-bic-guidelines-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Table&nbsp;10.3: Guidelines for comparing two models, <span class="math inline">\(M_1\)</span> and <span class="math inline">\(M_2\)</span>, using AIC and BIC
</figcaption>
<div aria-describedby="tbl-aic-bic-guidelines-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<table class="caption-top table">
<colgroup>
<col style="width: 36%">
<col style="width: 31%">
<col style="width: 32%">
</colgroup>
<thead>
<tr class="header">
<th>Strength of evidence in favor of <span class="math inline">\(M_2\)</span></th>
<th><span class="math inline">\(AIC_{M_1} - AIC_{M_2}\)</span><a href="#fn3" class="footnote-ref" id="fnref3" role="doc-noteref"><sup>3</sup></a></th>
<th><span class="math inline">\(BIC_{M_1} - BIC_{M_2}\)</span><a href="#fn4" class="footnote-ref" id="fnref4" role="doc-noteref"><sup>4</sup></a></th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>None</td>
<td>0 - 2</td>
<td>0 - 2</td>
</tr>
<tr class="even">
<td>Weak</td>
<td>2 - 7</td>
<td>2 - 6</td>
</tr>
<tr class="odd">
<td>Strong</td>
<td>7 - 10</td>
<td>6 - 10</td>
</tr>
<tr class="even">
<td>Very strong</td>
<td><span class="math inline">\(&gt;\)</span> 10</td>
<td><span class="math inline">\(&gt;\)</span> 10</td>
</tr>
</tbody>
</table>
</div>
</figure>
</div>
<p>Below are the values of AIC and BIC from the candidate models introduced in <a href="#sec-adj-rsq" class="quarto-xref"><span>Section 10.2.1</span></a>.</p>
<div class="cell">
<div id="tbl-aic-bic-compare" class="cell quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-float-tbl figure">
<figcaption class="quarto-float-caption-top quarto-float-caption quarto-float-tbl" id="tbl-aic-bic-compare-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Table&nbsp;10.4: Comparing models using AIC and BIC
</figcaption>
<div aria-describedby="tbl-aic-bic-compare-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<div class="cell-output-display">
<table class="do-not-create-environment cell caption-top table table-sm table-striped small">
<thead>
<tr class="header">
<th style="text-align: left;">Model</th>
<th style="text-align: right;">AIC</th>
<th style="text-align: right;">BIC</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">Danceability</td>
<td style="text-align: right;">-427</td>
<td style="text-align: right;">-409</td>
</tr>
<tr class="even">
<td style="text-align: left;">Danceability, Mode, Liveness</td>
<td style="text-align: right;">-424</td>
<td style="text-align: right;">-394</td>
</tr>
</tbody>
</table>
</div>
</div>
</figure>
</div>
</div>
<div class="yourturn">
<p>Using <a href="12-logistic-prediction.html#tbl-aic-bic-compare" class="quarto-xref">Table&nbsp;<span>12.8</span></a>, which model would you choose based on AIC? Based on BIC? <a href="#fn5" class="footnote-ref" id="fnref5" role="doc-noteref"><sup>5</sup></a></p>
</div>
<p>In this example, the same model minimizes both AIC and BIC. In fact, based on the guidelines in <a href="#tbl-aic-bic-guidelines" class="quarto-xref">Table&nbsp;<span>10.3</span></a>, the difference in the values of BIC provides very strong support of the model that only includes <code>danceability</code>. Sometimes, a model may have the minimum value of AIC but not have the minimum value of BIC or vice versa. Thus, we can choose which statistic to prioritize based on the analysis objective. If the primary objective is explanation, the model selected by AIC is preferred, because AIC tends to choose the model with more variables that can help explain variability in the response. If the primary objective is prediction, the model selected by BIC is preferred, because BIC selects the model with fewer predictors, thus reducing the variability in the model predictions.</p>
<div class="analysis_in_practice">
<p><strong>Model comparison statistics</strong></p>
<p>Below is a summary of the model comparison statistics:</p>
<div id="tbl-model-compare-stats" class="quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-float-tbl figure">
<figcaption class="quarto-float-caption-top quarto-float-caption quarto-float-tbl" id="tbl-model-compare-stats-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Table&nbsp;10.5: : Model comparison statistics
</figcaption>
<div aria-describedby="tbl-model-compare-stats-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<table class="caption-top table">
<colgroup>
<col style="width: 22%">
<col style="width: 27%">
<col style="width: 22%">
<col style="width: 27%">
</colgroup>
<thead>
<tr class="header">
<th>Statistic</th>
<th>Equation</th>
<th>Values that indicate good fit</th>
<th>Prioritize when analysis objective is…</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>Adjusted <span class="math inline">\(R^2\)</span></td>
<td><span class="math inline">\(\frac{SSR/ (n - p - 1}{SST / (n - 1)}\)</span></td>
<td>Higher</td>
<td>Explanation</td>
</tr>
<tr class="even">
<td>RMSE</td>
<td><span class="math inline">\(\sqrt{\frac{SSR}{n}}\)</span></td>
<td>Lower</td>
<td>Prediction</td>
</tr>
<tr class="odd">
<td>AIC</td>
<td><span class="math inline">\(-2\log L + 2(p+1)\)</span></td>
<td>Lower</td>
<td>Explanation</td>
</tr>
<tr class="even">
<td>BIC</td>
<td><span class="math inline">\(-2\log L + \log(n)(p+1)\)</span></td>
<td>Lower</td>
<td>Prediction</td>
</tr>
</tbody>
</table>
</div>
</figure>
</div>
</div>
</section>
</section>
<section id="sec-stepwise-selection" class="level2" data-number="10.3">
<h2 data-number="10.3" class="anchored" data-anchor-id="sec-stepwise-selection"><span class="header-section-number">10.3</span> Stepwise model selection</h2>
<p>Now that we have a suite of model comparison statistics, let’s develop a workflow for using these statistics to choose a final model. In <a href="#sec-model-compare-stats" class="quarto-xref"><span>Section 10.2</span></a>, we compared two models with a small number of predictor variables. From <a href="#sec-spotify-intro" class="quarto-xref"><span>Section 10.1</span></a>, we see there are nine potential predictor variables. Even with nine potential predictors, it would be time consuming and computationally intensive to test every possible combination of predictors. <!--# make this less clunky--> In practice, we may even have as many as 20, 50, or many more predictors to consider for inclusion in a model. Therefore, we need methods that help us choose variables to include in the model in a systematic way. This is called <strong>model selection</strong>.</p>
<p>In particular, we will use a set of methods called <strong>stepwise selection</strong>, where were considering adding and/or removing one variable or a small subset of variables at a time (the steps).</p>
<!--# Key terms: Model selection: The process of choosing variables for a final model in a systematic way Stepwise selection: Model selection process in which variables are added or removed one at a time or a small subset at a time-->
<section id="sec-stepwise-forward" class="level3" data-number="10.3.1">
<h3 data-number="10.3.1" class="anchored" data-anchor-id="sec-stepwise-forward"><span class="header-section-number">10.3.1</span> Forward selection</h3>
<p>The first stepwise method is <strong>forward selection</strong>. In forward selection, we begin with the intercept-only model (also called the null model), and add variables one at a time until we can no longer find a model that is a better fit than the current one. We use the model comparison statistics from <a href="#sec-model-compare-stats" class="quarto-xref"><span>Section 10.2</span></a> to determine the variables to add to the model. The steps for forward selection are as follows:</p>
<p>Start with the intercept-only model, then for each step:</p>
<ol type="1">
<li>Consider all predictors that are not currently in the model one at a time. Compute the model fit statistic for each new candidate model.</li>
<li>Add the predictor that results in the best value of the statistic (minimum or maximum depending on the statistic).</li>
<li>Repeat until adding new predictors no longer improves the model fit.</li>
</ol>
<p>Let’s look at an example of forward selection using AIC to compare the models. In the first step, the “current” model is the intercept-only model. We compute AIC for this model and all possible models with a single predictor. <a href="#tbl-forward-step1" class="quarto-xref">Table&nbsp;<span>10.6</span></a> shows the results in order of AIC.</p>
<div class="cell">
<div id="tbl-forward-step1" class="cell quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-float-tbl figure">
<figcaption class="quarto-float-caption-top quarto-float-caption quarto-float-tbl" id="tbl-forward-step1-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Table&nbsp;10.6: Output from first step of forward selection. The model <code>valence ~ 1</code> is the intercept-only model.
</figcaption>
<div aria-describedby="tbl-forward-step1-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<div class="cell-output-display">
<table class="do-not-create-environment cell caption-top table table-sm table-striped small">
<thead>
<tr class="header">
<th style="text-align: left;">Candidate model</th>
<th style="text-align: right;">AIC</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">valence ~ danceability</td>
<td style="text-align: right;">-427</td>
</tr>
<tr class="even">
<td style="text-align: left;">valence ~ playlist_genre</td>
<td style="text-align: right;">-343</td>
</tr>
<tr class="odd">
<td style="text-align: left;">valence ~ energy</td>
<td style="text-align: right;">-179</td>
</tr>
<tr class="even">
<td style="text-align: left;">valence ~ duration</td>
<td style="text-align: right;">-146</td>
</tr>
<tr class="odd">
<td style="text-align: left;">valence ~ loudness</td>
<td style="text-align: right;">-136</td>
</tr>
<tr class="even">
<td style="text-align: left;">valence ~ liveness</td>
<td style="text-align: right;">-127</td>
</tr>
<tr class="odd">
<td style="text-align: left;">valence ~ 1</td>
<td style="text-align: right;">-127</td>
</tr>
<tr class="even">
<td style="text-align: left;">valence ~ mode</td>
<td style="text-align: right;">-125</td>
</tr>
<tr class="odd">
<td style="text-align: left;">valence ~ tempo</td>
<td style="text-align: right;">-125</td>
</tr>
<tr class="even">
<td style="text-align: left;">valence ~ acousticness</td>
<td style="text-align: right;">-125</td>
</tr>
</tbody>
</table>
</div>
</div>
</figure>
</div>
</div>
<p>Based on AIC, a model with <code>danceability</code> is the best model out of the current candidates. Therefore, as forward selection progresses, we limit the space of candidate models to those that include <code>danceability</code> as a predictor. <a href="#tbl-forward-step2" class="quarto-xref">Table&nbsp;<span>10.7</span></a> shows the next step of forward selection. We compute AIC for all two-predictor models that have <code>danceability</code> as one of the predictors, along with the current model that only has <code>danceability</code> as a predictor.</p>
<div class="cell">
<div id="tbl-forward-step2" class="cell quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-float-tbl figure">
<figcaption class="quarto-float-caption-top quarto-float-caption quarto-float-tbl" id="tbl-forward-step2-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Table&nbsp;10.7: Output from second step of forward selection
</figcaption>
<div aria-describedby="tbl-forward-step2-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<div class="cell-output-display">
<table class="do-not-create-environment cell caption-top table table-sm table-striped small">
<thead>
<tr class="header">
<th style="text-align: left;">Candidate model</th>
<th style="text-align: right;">AIC</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">valence ~ danceability + playlist_genre</td>
<td style="text-align: right;">-709</td>
</tr>
<tr class="even">
<td style="text-align: left;">valence ~ danceability + energy</td>
<td style="text-align: right;">-508</td>
</tr>
<tr class="odd">
<td style="text-align: left;">valence ~ danceability + loudness</td>
<td style="text-align: right;">-439</td>
</tr>
<tr class="even">
<td style="text-align: left;">valence ~ danceability + duration</td>
<td style="text-align: right;">-438</td>
</tr>
<tr class="odd">
<td style="text-align: left;">valence ~ danceability + tempo</td>
<td style="text-align: right;">-432</td>
</tr>
<tr class="even">
<td style="text-align: left;">valence ~ danceability</td>
<td style="text-align: right;">-427</td>
</tr>
<tr class="odd">
<td style="text-align: left;">valence ~ danceability + mode</td>
<td style="text-align: right;">-425</td>
</tr>
<tr class="even">
<td style="text-align: left;">valence ~ danceability + liveness</td>
<td style="text-align: right;">-425</td>
</tr>
<tr class="odd">
<td style="text-align: left;">valence ~ danceability + acousticness</td>
<td style="text-align: right;">-425</td>
</tr>
</tbody>
</table>
</div>
</div>
</figure>
</div>
</div>
<p>Based on <a href="#tbl-forward-step2" class="quarto-xref">Table&nbsp;<span>10.7</span></a>, we choose the model that includes <code>danceability</code> and <code>playlist_genre</code>, because it is the model that minimizes AIC. Now, as we continue with forward selection, the space of potential models is narrowed to those that have <code>danceability</code> and <code>playlist_genre</code> as predictors. This process is continued until adding a new predictor to the model does not improve model fit based on AIC.</p>
<div class="cell">
<div id="tbl-forward-final" class="cell quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-float-tbl figure">
<figcaption class="quarto-float-caption-top quarto-float-caption quarto-float-tbl" id="tbl-forward-final-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Table&nbsp;10.8: Model selected by forward selection using AIC as criteria
</figcaption>
<div aria-describedby="tbl-forward-final-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<div class="cell-output-display">
<table class="do-not-create-environment cell caption-top table table-sm table-striped small">
<thead>
<tr class="header">
<th style="text-align: left;">term</th>
<th style="text-align: right;">estimate</th>
<th style="text-align: right;">std.error</th>
<th style="text-align: right;">statistic</th>
<th style="text-align: right;">p.value</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">(Intercept)</td>
<td style="text-align: right;">-0.423</td>
<td style="text-align: right;">0.046</td>
<td style="text-align: right;">-9.16</td>
<td style="text-align: right;">0.000</td>
</tr>
<tr class="even">
<td style="text-align: left;">danceability</td>
<td style="text-align: right;">0.639</td>
<td style="text-align: right;">0.029</td>
<td style="text-align: right;">21.88</td>
<td style="text-align: right;">0.000</td>
</tr>
<tr class="odd">
<td style="text-align: left;">playlist_genrelatin</td>
<td style="text-align: right;">0.203</td>
<td style="text-align: right;">0.013</td>
<td style="text-align: right;">15.90</td>
<td style="text-align: right;">0.000</td>
</tr>
<tr class="even">
<td style="text-align: left;">playlist_genrepop</td>
<td style="text-align: right;">0.162</td>
<td style="text-align: right;">0.013</td>
<td style="text-align: right;">12.82</td>
<td style="text-align: right;">0.000</td>
</tr>
<tr class="odd">
<td style="text-align: left;">playlist_genrer&amp;b</td>
<td style="text-align: right;">0.209</td>
<td style="text-align: right;">0.014</td>
<td style="text-align: right;">15.44</td>
<td style="text-align: right;">0.000</td>
</tr>
<tr class="even">
<td style="text-align: left;">playlist_genrerap</td>
<td style="text-align: right;">0.135</td>
<td style="text-align: right;">0.013</td>
<td style="text-align: right;">10.57</td>
<td style="text-align: right;">0.000</td>
</tr>
<tr class="odd">
<td style="text-align: left;">playlist_genrerock</td>
<td style="text-align: right;">0.224</td>
<td style="text-align: right;">0.014</td>
<td style="text-align: right;">15.66</td>
<td style="text-align: right;">0.000</td>
</tr>
<tr class="even">
<td style="text-align: left;">energy</td>
<td style="text-align: right;">0.439</td>
<td style="text-align: right;">0.032</td>
<td style="text-align: right;">13.85</td>
<td style="text-align: right;">0.000</td>
</tr>
<tr class="odd">
<td style="text-align: left;">acousticness</td>
<td style="text-align: right;">0.101</td>
<td style="text-align: right;">0.020</td>
<td style="text-align: right;">5.12</td>
<td style="text-align: right;">0.000</td>
</tr>
<tr class="even">
<td style="text-align: left;">duration_min</td>
<td style="text-align: right;">-0.018</td>
<td style="text-align: right;">0.004</td>
<td style="text-align: right;">-4.80</td>
<td style="text-align: right;">0.000</td>
</tr>
<tr class="odd">
<td style="text-align: left;">loudness</td>
<td style="text-align: right;">-0.007</td>
<td style="text-align: right;">0.002</td>
<td style="text-align: right;">-4.13</td>
<td style="text-align: right;">0.000</td>
</tr>
<tr class="even">
<td style="text-align: left;">tempo</td>
<td style="text-align: right;">0.000</td>
<td style="text-align: right;">0.000</td>
<td style="text-align: right;">3.29</td>
<td style="text-align: right;">0.001</td>
</tr>
</tbody>
</table>
</div>
</div>
</figure>
</div>
</div>
<p><a href="#tbl-forward-final" class="quarto-xref">Table&nbsp;<span>10.8</span></a> shows the model selected using forward selection with AIC as the selection criteria. Using this model selection approach, all predictors except <code>liveness</code> and <code>mode</code> were included in the final model. The AIC for this model is -954.989.</p>
</section>
<section id="backward-selection" class="level3" data-number="10.3.2">
<h3 data-number="10.3.2" class="anchored" data-anchor-id="backward-selection"><span class="header-section-number">10.3.2</span> Backward selection</h3>
<p>The next stepwise method is <strong>backward selection</strong>. Backward selection begins with the full model that contains all predictors and removes variables one at a time until removing a predictor no longer improves the model fit. We use the model fit statistics from <a href="#sec-model-compare-stats" class="quarto-xref"><span>Section 10.2</span></a> to determine the variables to remove from the model. The steps for backward selection are as follows:</p>
<p>Start with the full model, then for each step:</p>
<ol type="1">
<li>Remove the predictors in the current model one at a time, and compute the model fit statistic of the resulting model. <!--# less clunky way to say this?--> Compute the model comparison statistic for each new candidate model.</li>
<li>Remove the predictor that results in the best value of the statistic (minimum or maximum depending on the statistic).</li>
<li>Repeat until removing a predictor no longer improves the model fit.</li>
</ol>
<p>Let’s look at an example of backward selection using AIC. In the first step, we fit all possible models in which a single predictor is removed and compute the AIC for these models, along with the AIC for the full model with all predictors . <a href="#tbl-backward-step1" class="quarto-xref">Table&nbsp;<span>10.9</span></a> shows the results in order of AIC.</p>
<div class="cell">
<div id="tbl-backward-step1" class="cell quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-float-tbl figure">
<figcaption class="quarto-float-caption-top quarto-float-caption quarto-float-tbl" id="tbl-backward-step1-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Table&nbsp;10.9: Output from first step of backward selection (<code>-var</code> indicates which variable is removed)
</figcaption>
<div aria-describedby="tbl-backward-step1-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<div class="cell-output-display">
<table class="do-not-create-environment cell caption-top table table-sm table-striped small">
<thead>
<tr class="header">
<th style="text-align: left;">Candidate model</th>
<th style="text-align: right;">AIC</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">- mode</td>
<td style="text-align: right;">-953</td>
</tr>
<tr class="even">
<td style="text-align: left;">- liveness</td>
<td style="text-align: right;">-953</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Full model</td>
<td style="text-align: right;">-951</td>
</tr>
<tr class="even">
<td style="text-align: left;">- tempo</td>
<td style="text-align: right;">-942</td>
</tr>
<tr class="odd">
<td style="text-align: left;">- loudness</td>
<td style="text-align: right;">-936</td>
</tr>
<tr class="even">
<td style="text-align: left;">- duration</td>
<td style="text-align: right;">-930</td>
</tr>
<tr class="odd">
<td style="text-align: left;">- acousticness</td>
<td style="text-align: right;">-927</td>
</tr>
<tr class="even">
<td style="text-align: left;">- energy</td>
<td style="text-align: right;">-770</td>
</tr>
<tr class="odd">
<td style="text-align: left;">- playlist_genre</td>
<td style="text-align: right;">-577</td>
</tr>
<tr class="even">
<td style="text-align: left;">- danceability</td>
<td style="text-align: right;">-512</td>
</tr>
</tbody>
</table>
</div>
</div>
</figure>
</div>
</div>
<p>After the first step, we remove the predictor <code>mode</code> from the model. Thus, in the next step, the space of potential models is narrowed to those that do not include <code>mode</code>.</p>
<div class="cell">
<div id="tbl-backward-step2" class="cell quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-float-tbl figure">
<figcaption class="quarto-float-caption-top quarto-float-caption quarto-float-tbl" id="tbl-backward-step2-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Table&nbsp;10.10: Output from second step of backward selection (<code>-var</code> indicates which variable is removed)
</figcaption>
<div aria-describedby="tbl-backward-step2-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<div class="cell-output-display">
<table class="do-not-create-environment cell caption-top table table-sm table-striped small">
<thead>
<tr class="header">
<th style="text-align: left;">Candidate model</th>
<th style="text-align: right;">AIC</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">- liveness</td>
<td style="text-align: right;">-955</td>
</tr>
<tr class="even">
<td style="text-align: left;">Remove none</td>
<td style="text-align: right;">-953</td>
</tr>
<tr class="odd">
<td style="text-align: left;">- tempo</td>
<td style="text-align: right;">-944</td>
</tr>
<tr class="even">
<td style="text-align: left;">- loudness</td>
<td style="text-align: right;">-938</td>
</tr>
<tr class="odd">
<td style="text-align: left;">- duration</td>
<td style="text-align: right;">-932</td>
</tr>
<tr class="even">
<td style="text-align: left;">- acousticness</td>
<td style="text-align: right;">-929</td>
</tr>
<tr class="odd">
<td style="text-align: left;">- energy</td>
<td style="text-align: right;">-772</td>
</tr>
<tr class="even">
<td style="text-align: left;">- playlist_genre</td>
<td style="text-align: right;">-578</td>
</tr>
<tr class="odd">
<td style="text-align: left;">- danceability</td>
<td style="text-align: right;">-514</td>
</tr>
</tbody>
</table>
</div>
</div>
</figure>
</div>
</div>
<p>In the next step, we compute the AIC for the current model with only <code>mode</code> removed and the models with <code>mode</code> and one other predictor removed. After the second step in <a href="#tbl-backward-step2" class="quarto-xref">Table&nbsp;<span>10.10</span></a>, we remove <code>liveness</code> and choose the model in which <code>liveness</code> is removed (along with <code>mode</code> that was removed in the previous step). We continue this process until removing a new predictor does not improve model fit. The final model selected by backward selection is in <a href="#tbl-backward-final" class="quarto-xref">Table&nbsp;<span>10.11</span></a>.</p>
<div class="cell">
<div id="tbl-backward-final" class="cell quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-float-tbl figure">
<figcaption class="quarto-float-caption-top quarto-float-caption quarto-float-tbl" id="tbl-backward-final-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Table&nbsp;10.11: Model selected using backward selection with AIC as selection criteria
</figcaption>
<div aria-describedby="tbl-backward-final-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<div class="cell-output-display">
<table class="do-not-create-environment cell caption-top table table-sm table-striped small">
<thead>
<tr class="header">
<th style="text-align: left;">term</th>
<th style="text-align: right;">estimate</th>
<th style="text-align: right;">std.error</th>
<th style="text-align: right;">statistic</th>
<th style="text-align: right;">p.value</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">(Intercept)</td>
<td style="text-align: right;">-0.423</td>
<td style="text-align: right;">0.046</td>
<td style="text-align: right;">-9.16</td>
<td style="text-align: right;">0.000</td>
</tr>
<tr class="even">
<td style="text-align: left;">playlist_genrelatin</td>
<td style="text-align: right;">0.203</td>
<td style="text-align: right;">0.013</td>
<td style="text-align: right;">15.90</td>
<td style="text-align: right;">0.000</td>
</tr>
<tr class="odd">
<td style="text-align: left;">playlist_genrepop</td>
<td style="text-align: right;">0.162</td>
<td style="text-align: right;">0.013</td>
<td style="text-align: right;">12.82</td>
<td style="text-align: right;">0.000</td>
</tr>
<tr class="even">
<td style="text-align: left;">playlist_genrer&amp;b</td>
<td style="text-align: right;">0.209</td>
<td style="text-align: right;">0.014</td>
<td style="text-align: right;">15.44</td>
<td style="text-align: right;">0.000</td>
</tr>
<tr class="odd">
<td style="text-align: left;">playlist_genrerap</td>
<td style="text-align: right;">0.135</td>
<td style="text-align: right;">0.013</td>
<td style="text-align: right;">10.57</td>
<td style="text-align: right;">0.000</td>
</tr>
<tr class="even">
<td style="text-align: left;">playlist_genrerock</td>
<td style="text-align: right;">0.224</td>
<td style="text-align: right;">0.014</td>
<td style="text-align: right;">15.66</td>
<td style="text-align: right;">0.000</td>
</tr>
<tr class="odd">
<td style="text-align: left;">danceability</td>
<td style="text-align: right;">0.639</td>
<td style="text-align: right;">0.029</td>
<td style="text-align: right;">21.88</td>
<td style="text-align: right;">0.000</td>
</tr>
<tr class="even">
<td style="text-align: left;">energy</td>
<td style="text-align: right;">0.439</td>
<td style="text-align: right;">0.032</td>
<td style="text-align: right;">13.85</td>
<td style="text-align: right;">0.000</td>
</tr>
<tr class="odd">
<td style="text-align: left;">loudness</td>
<td style="text-align: right;">-0.007</td>
<td style="text-align: right;">0.002</td>
<td style="text-align: right;">-4.13</td>
<td style="text-align: right;">0.000</td>
</tr>
<tr class="even">
<td style="text-align: left;">acousticness</td>
<td style="text-align: right;">0.101</td>
<td style="text-align: right;">0.020</td>
<td style="text-align: right;">5.12</td>
<td style="text-align: right;">0.000</td>
</tr>
<tr class="odd">
<td style="text-align: left;">tempo</td>
<td style="text-align: right;">0.000</td>
<td style="text-align: right;">0.000</td>
<td style="text-align: right;">3.29</td>
<td style="text-align: right;">0.001</td>
</tr>
<tr class="even">
<td style="text-align: left;">duration_min</td>
<td style="text-align: right;">-0.018</td>
<td style="text-align: right;">0.004</td>
<td style="text-align: right;">-4.80</td>
<td style="text-align: right;">0.000</td>
</tr>
</tbody>
</table>
</div>
</div>
</figure>
</div>
</div>
<!--# add comemnts about the criticisms of these methods. If short enough, this can be a callout box-->
<!--# Section 4.3 of Harrell's Regression Modeling Strategies, Section 11.4 of the Feature Engineering book. -->
<!--# talk about some strategies to mitigate some of these issues like having the the testing set (coming in upcoming section) and bootstrapping-->
<!--# Talk about using the p-value for the selection criteria and problems with that.-->
<!--# mention that issues can be mitigated by using criteria such as AiC and BIC for model selection, and can reduce issues with potential overfitting by using a test set or something like cross validation. - Maybe use ISLR pg 229 as reference here.-->
</section>
</section>
<section id="sec-training-testing" class="level2" data-number="10.4">
<h2 data-number="10.4" class="anchored" data-anchor-id="sec-training-testing"><span class="header-section-number">10.4</span> Training and testing sets</h2>
<!--# do i want to call the section something like Model selection in practice with testing/training and cross validation as subsections?-->
<p>Now let’s expand on the methods from the previous sections to develop a model building workflow. In <a href="#sec-stepwise-selection" class="quarto-xref"><span>Section 10.3</span></a>, we used the entire sample data set to choose a model using stepwise selection methods. In fact, we have used the entire data set in all analyses done in the book thus far. It is appropriate statistically to use the entire data set for analysis and sometimes is the best choice given the analysis purpose. For example, using the entire sample may be a good analysis decision if the primary objective is explanation (particularly if <span class="math inline">\(n\)</span> is small), because the model performance on new data is not necessarily important for the analysis goals. <!--# need to modify this to align with the example later in the section.--></p>
<p>In contrast, if the primary analysis objective is prediction, then we do not get all the information needed to evaluate model performance when we use all the data to build the model. Specifically, if all of the data is used in the model building process, then there is no data left to evaluate how well the model predicts for new observations. In general, we do not want to implement a model for widespread use without having some evaluation of how it performs on new data, particularly if there are serious implications for inaccurate model results, such as models used to inform business decisions or health diagnoses.</p>
<section id="using-training-and-testing-sets" class="level3" data-number="10.4.1">
<h3 data-number="10.4.1" class="anchored" data-anchor-id="using-training-and-testing-sets"><span class="header-section-number">10.4.1</span> Using training and testing sets</h3>
<p>One way to evaluate the model performance on new data is to collect more data. This is often not a feasible solution in practice, because data collection is often time consuming and expensive. Another solution, then, is to split the sample data so that some observations are set aside to act as “new data”. Thus, we can split the sample data into two subsets, the training and testing set. The <strong>training set</strong> is the subset that is used to build the model, and the <strong>testing set</strong> is the subset that is used to evaluate how well the final model performs on new data. The testing set is only used to evaluate the final model. The final model is not changed based on the results from the testing set in order to prevent overfitting the model.</p>
<!--# Key terms: Sample data: Full data set used in the analysis Training set: Subset of the sample data used for model building Testing set: Subset of the sample data used to evaluate performance of final model Overfitting: Fitting a model so closely to the model building data that it performs poorly on new data.-->
<p>There are multiple ways to split the data into training and testing sets as shown in <a href="#fig-train-test" class="quarto-xref">Figure&nbsp;<span>10.3</span></a>.</p>
<div id="fig-train-test" class="quarto-layout-panel">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-train-test-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<div class="quarto-layout-row">
<div class="cell-output-display quarto-layout-cell-subref quarto-layout-cell" data-ref-parent="fig-train-test" style="flex-basis: 50.0%;justify-content: flex-start;">
<div id="fig-train-test-1" class="quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-subfloat-fig figure">
<div aria-describedby="fig-train-test-1-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<a href="images/10-train-test-random.png" class="lightbox" data-gallery="fig-train-test" title="Figure&nbsp;10.3&nbsp;(a): Simple random sample"><img src="images/10-train-test-random.png" class="img-fluid figure-img" style="width:100.0%" data-ref-parent="fig-train-test"></a>
</div>
<figcaption class="quarto-float-caption-bottom quarto-subfloat-caption quarto-subfloat-fig" id="fig-train-test-1-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
(a) Simple random sample
</figcaption>
</figure>
</div>
</div>
<div class="cell-output-display quarto-layout-cell-subref quarto-layout-cell" data-ref-parent="fig-train-test" style="flex-basis: 50.0%;justify-content: flex-start;">
<div id="fig-train-test-2" class="quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-subfloat-fig figure">
<div aria-describedby="fig-train-test-2-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<a href="images/10-train-test-stratified.png" class="lightbox" data-gallery="fig-train-test" title="Figure&nbsp;10.3&nbsp;(b): Stratified random sample"><img src="images/10-train-test-stratified.png" class="img-fluid figure-img" style="width:100.0%" data-ref-parent="fig-train-test"></a>
</div>
<figcaption class="quarto-float-caption-bottom quarto-subfloat-caption quarto-subfloat-fig" id="fig-train-test-2-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
(b) Stratified random sample
</figcaption>
</figure>
</div>
</div>
</div>
<div class="quarto-layout-row">
<div class="cell-output-display quarto-layout-cell-subref quarto-layout-cell" data-ref-parent="fig-train-test" style="flex-basis: 50.0%;justify-content: flex-start;">
<div id="fig-train-test-3" class="quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-subfloat-fig figure">
<div aria-describedby="fig-train-test-3-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<a href="images/10-train-test-time.png" class="lightbox" data-gallery="fig-train-test" title="Figure&nbsp;10.3&nbsp;(c): Time ordered"><img src="images/10-train-test-time.png" class="img-fluid figure-img" style="width:100.0%" data-ref-parent="fig-train-test"></a>
</div>
<figcaption class="quarto-float-caption-bottom quarto-subfloat-caption quarto-subfloat-fig" id="fig-train-test-3-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
(c) Time ordered
</figcaption>
</figure>
</div>
</div>
</div>
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-train-test-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;10.3: Splitting data into training and testing sets
</figcaption>
</figure>
</div>
<p>The most common way to assign observations to the training or testing set is to take a simple random sample such that <span class="math inline">\(Z\%\)</span> of the observations are in the training set and <span class="math inline">\((100 - Z)\%\)</span> are in the testing set (<a href="#fig-train-test-1" class="quarto-xref">Figure&nbsp;<span>10.3 (a)</span></a>). A common split is 80% training and 20% testing; however, <!--# is there a citation for this?-->there is no magic number for the best split. The primary consideration for determining a split is the overall size of the sample data and ensuring there are enough observations in the training set to conduct inference and model evaluation. For example, if the data set is small (e.g., 100 observations), perhaps a split of 90% training and 10% testing may be preferred, so that as much data as possible is available for the model building process.</p>
<p>Another common approach is to take a stratified random sample (<a href="#fig-train-test-2" class="quarto-xref">Figure&nbsp;<span>10.3 (b)</span></a>). This may be the preferred approach is there are particular subgroups you want to ensure make up an exact proportion of the observations in the training and testing sets. For example, suppose <span class="math inline">\(W\%\)</span> of the population is part of a particular subgroup, and we want to ensure exactly <span class="math inline">\(W\%\)</span> of the observations in the training and testing sets are in that group. In this case, we stratify the data by group, then take <span class="math inline">\(Z\%\)</span> for training and <span class="math inline">\((100 - Z)\%\)</span> for testing within each subgroup. <!--# maybe make this more concrete by using a spotify example--></p>
<p>Finally, if time is an important component of the data, another option is to use the most recent time period as the testing set and all previous time periods for the training set (<a href="#fig-train-test-3" class="quarto-xref">Figure&nbsp;<span>10.3 (c)</span></a>). This is especially helpful if the model will be used for predicting future observations (called <strong>forecasting</strong>).</p>
<p>Once the data have been split into training and testing sets, we use the following workflow.</p>
<ol type="1">
<li>Conduct exploratory data analysis separately on the training and testing sets to evaluate how they compare to the full sample data and observe if they contain unusual observations, such as outliers, that may impact model results later on.</li>
<li>Put the testing set aside. Using only the <u><strong>training set</strong></u>:
<ol type="i">
<li>Fit and evaluate models using the statistics and model selection procedures, such as those introduced in <a href="#sec-model-compare-stats" class="quarto-xref"><span>Section 10.2</span></a> and <a href="#sec-stepwise-selection" class="quarto-xref"><span>Section 10.3</span></a> to select an initial main effects model.</li>
<li>Evaluate model fit statistics, model conditions, and diagnostics for the selected model.</li>
<li>Consider potential interaction terms, higher order terms, transformations, etc.</li>
<li>Repeat steps ii - iii, as needed, until a final model is chosen.</li>
</ol></li>
<li>Use the <u><strong>testing set</strong></u> to compute predictions and evaluate how well the final model performs on new data using RMSE or <span class="math inline">\(R^2\)</span>. <!--# make sure I've mentioned in somewhere in the book that R-sq is also the correlation between y and yhat--></li>
<li>Use the entire sample data (training and testing set) to refit the model selected in Step 2 and to get the final estimated model coefficients and statistics. These estimated coefficients should be similar to the statistics from Step 2. We use the full sample data to estimate the coefficients for the final model at the end, so that the coefficients and associated inferential statistics are estimated using all available data.</li>
<li>Use the model for inferential conclusions and/or prediction based on the analysis objective.</li>
</ol>
</section>
<section id="model-building-workflow-example" class="level3" data-number="10.4.2">
<h3 data-number="10.4.2" class="anchored" data-anchor-id="model-building-workflow-example"><span class="header-section-number">10.4.2</span> Model building workflow example</h3>
<p>Here we apply this workflow to the Spotify data. First, we split the data into the commonly used 80% training and 20% testing sets. The original sample data has 3000 observations, so the training set has 2400 observations and the testing set has 600 observations. <a href="#fig-train-test-eda" class="quarto-xref">Figure&nbsp;<span>10.4</span></a> shows a comparison of the distribution of <code>valence</code> in the full sample data, training set, and testing set. The distributions have a similar shape and are all centered around 0.5.</p>
<div id="fig-train-test-eda" class="quarto-layout-panel">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-train-test-eda-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<div class="quarto-layout-row">
<div class="cell-output-display quarto-layout-cell-subref quarto-layout-cell" data-ref-parent="fig-train-test-eda" style="flex-basis: 33.3%;justify-content: flex-start;">
<div id="fig-train-test-eda-1" class="quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-subfloat-fig figure">
<div aria-describedby="fig-train-test-eda-1-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<a href="10-model-eval_files/figure-html/fig-train-test-eda-1.png" class="lightbox" data-gallery="fig-train-test-eda" title="Figure&nbsp;10.4&nbsp;(a): Full sample data"><img src="10-model-eval_files/figure-html/fig-train-test-eda-1.png" class="img-fluid figure-img" style="width:100.0%" data-ref-parent="fig-train-test-eda"></a>
</div>
<figcaption class="quarto-float-caption-bottom quarto-subfloat-caption quarto-subfloat-fig" id="fig-train-test-eda-1-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
(a) Full sample data
</figcaption>
</figure>
</div>
</div>
<div class="cell-output-display quarto-layout-cell-subref quarto-layout-cell" data-ref-parent="fig-train-test-eda" style="flex-basis: 33.3%;justify-content: flex-start;">
<div id="fig-train-test-eda-2" class="quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-subfloat-fig figure">
<div aria-describedby="fig-train-test-eda-2-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<a href="10-model-eval_files/figure-html/fig-train-test-eda-2.png" class="lightbox" data-gallery="fig-train-test-eda" title="Figure&nbsp;10.4&nbsp;(b): Training set"><img src="10-model-eval_files/figure-html/fig-train-test-eda-2.png" class="img-fluid figure-img" style="width:100.0%" data-ref-parent="fig-train-test-eda"></a>
</div>
<figcaption class="quarto-float-caption-bottom quarto-subfloat-caption quarto-subfloat-fig" id="fig-train-test-eda-2-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
(b) Training set
</figcaption>
</figure>
</div>
</div>
<div class="cell-output-display quarto-layout-cell-subref quarto-layout-cell" data-ref-parent="fig-train-test-eda" style="flex-basis: 33.3%;justify-content: flex-start;">
<div id="fig-train-test-eda-3" class="quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-subfloat-fig figure">
<div aria-describedby="fig-train-test-eda-3-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<a href="10-model-eval_files/figure-html/fig-train-test-eda-3.png" class="lightbox" data-gallery="fig-train-test-eda" title="Figure&nbsp;10.4&nbsp;(c): Testing set"><img src="10-model-eval_files/figure-html/fig-train-test-eda-3.png" class="img-fluid figure-img" style="width:100.0%" data-ref-parent="fig-train-test-eda"></a>
</div>
<figcaption class="quarto-float-caption-bottom quarto-subfloat-caption quarto-subfloat-fig" id="fig-train-test-eda-3-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
(c) Testing set
</figcaption>
</figure>
</div>
</div>
</div>
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-train-test-eda-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;10.4: Distribution of <code>valence</code> in full sample data, training set, and testing set
</figcaption>
</figure>
</div>
<p>For now we put the testing set aside and use the training set to build a model. Because the primary analysis objective in <a href="#sec-spotify-intro" class="quarto-xref"><span>Section 10.1</span></a> is explanation, we’ll use forward selection with AIC as the selection criteria. <a href="#tbl-spotify-model-train" class="quarto-xref">Table&nbsp;<span>10.12</span></a> is the model selected by this process.</p>
<div class="cell">
<div id="tbl-spotify-model-train" class="cell quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-float-tbl figure">
<figcaption class="quarto-float-caption-top quarto-float-caption quarto-float-tbl" id="tbl-spotify-model-train-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Table&nbsp;10.12: Model selected by forward selection with AIC as selection criteria using the training set
</figcaption>
<div aria-describedby="tbl-spotify-model-train-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<div class="cell-output-display">
<table class="do-not-create-environment cell caption-top table table-sm table-striped small">
<thead>
<tr class="header">
<th style="text-align: left;">term</th>
<th style="text-align: right;">estimate</th>
<th style="text-align: right;">std.error</th>
<th style="text-align: right;">statistic</th>
<th style="text-align: right;">p.value</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">(Intercept)</td>
<td style="text-align: right;">-0.424</td>
<td style="text-align: right;">0.051</td>
<td style="text-align: right;">-8.28</td>
<td style="text-align: right;">0.000</td>
</tr>
<tr class="even">
<td style="text-align: left;">danceability</td>
<td style="text-align: right;">0.629</td>
<td style="text-align: right;">0.033</td>
<td style="text-align: right;">19.25</td>
<td style="text-align: right;">0.000</td>
</tr>
<tr class="odd">
<td style="text-align: left;">playlist_genrelatin</td>
<td style="text-align: right;">0.215</td>
<td style="text-align: right;">0.014</td>
<td style="text-align: right;">15.12</td>
<td style="text-align: right;">0.000</td>
</tr>
<tr class="even">
<td style="text-align: left;">playlist_genrepop</td>
<td style="text-align: right;">0.172</td>
<td style="text-align: right;">0.014</td>
<td style="text-align: right;">12.17</td>
<td style="text-align: right;">0.000</td>
</tr>
<tr class="odd">
<td style="text-align: left;">playlist_genrer&amp;b</td>
<td style="text-align: right;">0.218</td>
<td style="text-align: right;">0.015</td>
<td style="text-align: right;">14.61</td>
<td style="text-align: right;">0.000</td>
</tr>
<tr class="even">
<td style="text-align: left;">playlist_genrerap</td>
<td style="text-align: right;">0.144</td>
<td style="text-align: right;">0.014</td>
<td style="text-align: right;">10.14</td>
<td style="text-align: right;">0.000</td>
</tr>
<tr class="odd">
<td style="text-align: left;">playlist_genrerock</td>
<td style="text-align: right;">0.230</td>
<td style="text-align: right;">0.016</td>
<td style="text-align: right;">14.65</td>
<td style="text-align: right;">0.000</td>
</tr>
<tr class="even">
<td style="text-align: left;">energy</td>
<td style="text-align: right;">0.451</td>
<td style="text-align: right;">0.036</td>
<td style="text-align: right;">12.55</td>
<td style="text-align: right;">0.000</td>
</tr>
<tr class="odd">
<td style="text-align: left;">acousticness</td>
<td style="text-align: right;">0.107</td>
<td style="text-align: right;">0.022</td>
<td style="text-align: right;">4.94</td>
<td style="text-align: right;">0.000</td>
</tr>
<tr class="even">
<td style="text-align: left;">duration_min</td>
<td style="text-align: right;">-0.019</td>
<td style="text-align: right;">0.004</td>
<td style="text-align: right;">-4.56</td>
<td style="text-align: right;">0.000</td>
</tr>
<tr class="odd">
<td style="text-align: left;">loudness</td>
<td style="text-align: right;">-0.008</td>
<td style="text-align: right;">0.002</td>
<td style="text-align: right;">-4.10</td>
<td style="text-align: right;">0.000</td>
</tr>
<tr class="even">
<td style="text-align: left;">tempo</td>
<td style="text-align: right;">0.000</td>
<td style="text-align: right;">0.000</td>
<td style="text-align: right;">2.46</td>
<td style="text-align: right;">0.014</td>
</tr>
</tbody>
</table>
</div>
</div>
</figure>
</div>
</div>
<p>Next, we check the model conditions and diagnostics from <a href="08-mlr-inference.html#sec-mlr-conditions-diagnositics" class="quarto-xref"><span>Section 8.5</span></a> for the selected model.</p>
<div class="yourturn">
<p>Which data set is used to check model conditions - full sample data, training set, testing set?<a href="#fn6" class="footnote-ref" id="fnref6" role="doc-noteref"><sup>6</sup></a></p>
</div>
<div id="fig-spotify-train-conditions" class="quarto-layout-panel">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-spotify-train-conditions-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<div class="quarto-layout-row">
<div class="cell-output-display quarto-layout-cell-subref quarto-layout-cell" data-ref-parent="fig-spotify-train-conditions" style="flex-basis: 33.3%;justify-content: flex-start;">
<div id="fig-spotify-train-conditions-1" class="quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-subfloat-fig figure">
<div aria-describedby="fig-spotify-train-conditions-1-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<a href="10-model-eval_files/figure-html/fig-spotify-train-conditions-1.png" class="lightbox" data-gallery="fig-spotify-train-conditions" title="Figure&nbsp;10.5&nbsp;(a): Residuals vs.&nbsp;predicted"><img src="10-model-eval_files/figure-html/fig-spotify-train-conditions-1.png" class="img-fluid figure-img" style="width:100.0%" data-ref-parent="fig-spotify-train-conditions"></a>
</div>
<figcaption class="quarto-float-caption-bottom quarto-subfloat-caption quarto-subfloat-fig" id="fig-spotify-train-conditions-1-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
(a) Residuals vs.&nbsp;predicted
</figcaption>
</figure>
</div>
</div>
<div class="cell-output-display quarto-layout-cell-subref quarto-layout-cell" data-ref-parent="fig-spotify-train-conditions" style="flex-basis: 33.3%;justify-content: flex-start;">
<div id="fig-spotify-train-conditions-2" class="quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-subfloat-fig figure">
<div aria-describedby="fig-spotify-train-conditions-2-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<a href="10-model-eval_files/figure-html/fig-spotify-train-conditions-2.png" class="lightbox" data-gallery="fig-spotify-train-conditions" title="Figure&nbsp;10.5&nbsp;(b): Distribution of residuals"><img src="10-model-eval_files/figure-html/fig-spotify-train-conditions-2.png" class="img-fluid figure-img" style="width:100.0%" data-ref-parent="fig-spotify-train-conditions"></a>
</div>
<figcaption class="quarto-float-caption-bottom quarto-subfloat-caption quarto-subfloat-fig" id="fig-spotify-train-conditions-2-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
(b) Distribution of residuals
</figcaption>
</figure>
</div>
</div>
<div class="cell-output-display quarto-layout-cell-subref quarto-layout-cell" data-ref-parent="fig-spotify-train-conditions" style="flex-basis: 33.3%;justify-content: flex-start;">
<div id="fig-spotify-train-conditions-3" class="quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-subfloat-fig figure">
<div aria-describedby="fig-spotify-train-conditions-3-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<a href="10-model-eval_files/figure-html/fig-spotify-train-conditions-3.png" class="lightbox" data-gallery="fig-spotify-train-conditions" title="Figure&nbsp;10.5&nbsp;(c): Cook’s Distance"><img src="10-model-eval_files/figure-html/fig-spotify-train-conditions-3.png" class="img-fluid figure-img" style="width:100.0%" data-ref-parent="fig-spotify-train-conditions"></a>
</div>
<figcaption class="quarto-float-caption-bottom quarto-subfloat-caption quarto-subfloat-fig" id="fig-spotify-train-conditions-3-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
(c) Cook’s Distance
</figcaption>
</figure>
</div>
</div>
</div>
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-spotify-train-conditions-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;10.5: Model conditions and diagnostics for model in <a href="#tbl-spotify-model-train" class="quarto-xref">Table&nbsp;<span>10.12</span></a>
</figcaption>
</figure>
</div>
<p>From <a href="#fig-spotify-train-conditions" class="quarto-xref">Figure&nbsp;<span>10.5</span></a>, the linearity, equal variance, and normality conditions are satisfied and there are no influential observations based on Cook’s Distance. From the description in <a href="#sec-spotify-intro" class="quarto-xref"><span>Section 10.1</span></a>, we know that there is only one song for a given artist in the data, so we can reasonably conclude the independence condition is met as well. <a href="#tbl-spotify-model-train-stats" class="quarto-xref">Table&nbsp;<span>10.13</span></a> shows the RMSE and <span class="math inline">\(R^2\)</span> on the training set. We prioritize <span class="math inline">\(R^2\)</span>, because the primary analysis objective is explanation.</p>
<div class="cell">
<div id="tbl-spotify-model-train-stats" class="cell quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-float-tbl figure">
<figcaption class="quarto-float-caption-top quarto-float-caption quarto-float-tbl" id="tbl-spotify-model-train-stats-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Table&nbsp;10.13: Model performance statistics for model in <a href="#tbl-spotify-model-train" class="quarto-xref">Table&nbsp;<span>10.12</span></a>
</figcaption>
<div aria-describedby="tbl-spotify-model-train-stats-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<div class="cell-output-display">
<table class="do-not-create-environment cell caption-top table table-sm table-striped small">
<thead>
<tr class="header">
<th style="text-align: right;">R-sq</th>
<th style="text-align: right;">RMSE</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: right;">0.257</td>
<td style="text-align: right;">0.204</td>
</tr>
</tbody>
</table>
</div>
</div>
</figure>
</div>
</div>
<!--# Fix the $R^2$ formatting on table above-->
<p>This is a good point in the analysis to consider potential interaction terms, variable transformations, or higher order polynomial terms if there is indication from the exploratory data analysis that such terms would improve model fit. As we try new terms, we use RMSE, <span class="math inline">\(R^2\)</span>, and inferential statistics to evaluate whether to include them in the model. We will proceed with the model in <a href="#tbl-spotify-model-train" class="quarto-xref">Table&nbsp;<span>10.12</span></a> as the final model for the purposes of this example.</p>
<p>Now that we have selected the final model, we use the model to compute RMSE, <span class="math inline">\(R^2\)</span>, and predictions on the testing set. RMSE and <span class="math inline">\(R^2\)</span> are then used to evaluate how well the model performs on the testing set.</p>
<div class="cell">
<div id="tbl-spotify-test-train-compare" class="cell quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-float-tbl figure">
<figcaption class="quarto-float-caption-top quarto-float-caption quarto-float-tbl" id="tbl-spotify-test-train-compare-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Table&nbsp;10.14: Model performance statistics for the testing and training sets
</figcaption>
<div aria-describedby="tbl-spotify-test-train-compare-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<div class="cell-output-display">
<table class="do-not-create-environment cell caption-top table table-sm table-striped small">
<thead>
<tr class="header">
<th style="text-align: left;">Sample,</th>
<th style="text-align: right;">R-sq</th>
<th style="text-align: right;">RMSE</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">Training</td>
<td style="text-align: right;">0.257</td>
<td style="text-align: right;">0.204</td>
</tr>
<tr class="even">
<td style="text-align: left;">Testing</td>
<td style="text-align: right;">0.204</td>
<td style="text-align: right;">0.211</td>
</tr>
</tbody>
</table>
</div>
</div>
</figure>
</div>
</div>
<p><a href="#tbl-spotify-test-train-compare" class="quarto-xref">Table&nbsp;<span>10.14</span></a> shows the values of <span class="math inline">\(R^2\)</span> and RMSE for the training and testing set. When we fit a model, the goal is to adequately capture the trends in the data without capturing the trends so specifically that the can’t be used on new data. In general, we expect the model performance to be better (lower RMSE, higher <span class="math inline">\(R^2\)</span>) for the training set, because it was used to fit the model. When we compare these values, we want the results from the testing set to be similar, even if slightly worse, as the training set. When the results are similar, this means that the model can be generalized and reliably applied to new observations in the population. As we implement the model and use it to predict for new observations, we can expect a similar model performance as we have observed in the analysis. In contrast, if the model performs much better on the training set compared to the testing set, then it is indication of overfitting.</p>
<div class="analysis_in_practice">
<p>The goal when building a model is to capture the trends in the data while still making something that can applied to new data. When a model is overfit, a model will perform very well on the data used to fit it but perform very poorly on any new data. Overfitting generally occurs when there are complex interaction terms between three or more variables or polynomial terms that are cubic or high-order.</p>
<p><br></p>
<p>Avoid overfitting by preferencing simpler models that adequately capture the trends in the data over those that fit very closely to the training set used to build them.</p>
<p><br></p>
<p>Remember, model building is like making a suit that can generally fit everyone around a given size, not making a custom-tailored suit that can only fit one person perfectly. <!--# i like this analogy. is there a way to highlight it more?--></p>
</div>
<p>We note in <a href="#tbl-spotify-test-train-compare" class="quarto-xref">Table&nbsp;<span>10.14</span></a> the model performed better on the training data, but the performance statistics are similar for the training and testing sets. This means that we have not overfit the model to the training set and thus can feel some level of confidence that we understand how the model will perform on new data.</p>
<!--# REMOVED: This was true when the seed was 12345 -  Something that may not be intuitive, however, is that it appears the model performed slightly better on the testing set than the training set (though the difference is almost negligible). This is likely due to the random variability in the training and testing sets and the fact that the testing set includes a higher proportion of observations with very low valence. -->
</section>
</section>
<section id="cross-validation" class="level2" data-number="10.5">
<h2 data-number="10.5" class="anchored" data-anchor-id="cross-validation"><span class="header-section-number">10.5</span> Cross validation</h2>
<p>The testing set gives us information about the model performance on new data; however, using a single testing set can make it difficult to know how much the results are impacted by nuances in the data, such as the presence of outliers. Additionally, because the testing set is only used to evaluate the model performance once the model building process is complete, the information about the model’s performance on new data does not inform the final model selection. Having multiple sets for testing during the model selection process would help address these issues.</p>
<section id="resampling" class="level3" data-number="10.5.1">
<h3 data-number="10.5.1" class="anchored" data-anchor-id="resampling"><span class="header-section-number">10.5.1</span> Resampling</h3>
<p>We could collect more data to make additional testing sets, however, that is often not feasible in practice given time and cost constraints. Therefore, we will use <strong>resampling</strong>, the process of sampling from the data to generate “new” data sets. <!--# is this correct definition--> We have discussed two resampling methods earlier in the book, bootstrapping and permutation tests in <a href="08-mlr-inference.html#sec-mlr-sim-inf" class="quarto-xref"><span>Section 8.3</span></a>.</p>
<p>Because the goal is to generate multiple testing sets, we will resample in such a way that a different subset of the data is used to build the model and a different subset is used to evaluate the model’s performance on new data in each iteration. <em>We only use the training set for resampling</em>, so we can still reserve the testing set to evaluate the final model. <!--# what is a good way to emphasize this--> For each iteration of resampling from the training set, the subset of the training set used to build the model is called the <strong>analysis set</strong>, and the subset of the training set used to evaluate the model is the <strong>assessment set.</strong> We use these terms from <span class="citation" data-cites="kuhn2022tidy">Kuhn and Silge (<a href="references.html#ref-kuhn2022tidy" role="doc-biblioref">2022</a>)</span> to distinguish them from the training and testing sets. <a href="#fig-resampling" class="quarto-xref">Figure&nbsp;<span>10.6</span></a> shows the resampling process for <span class="math inline">\(k\)</span> iterations.</p>
<div id="fig-resampling" class="quarto-float quarto-figure quarto-figure-center anchored" data-fig-align="center">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-resampling-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<a href="images/10-resampling.png" class="lightbox" data-gallery="quarto-lightbox-gallery-30" title="Figure&nbsp;10.6: Illustration of resampling for k iterations. Solid blue = Analysis set, Striped green = Assessment set"><img src="images/10-resampling.png" class="img-fluid quarto-figure quarto-figure-center figure-img"></a>
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-resampling-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;10.6: Illustration of resampling for <em>k</em> iterations. Solid blue = Analysis set, Striped green = Assessment set
</figcaption>
</figure>
</div>
</section>
<section id="cross-validation-1" class="level3" data-number="10.5.2">
<h3 data-number="10.5.2" class="anchored" data-anchor-id="cross-validation-1"><span class="header-section-number">10.5.2</span> Cross validation</h3>
<p><strong>Cross validation</strong> (also called <em>k-fold cross validation</em>) is a resampling method that splits the data into <span class="math inline">\(k\)</span> subsets called <strong>folds</strong>. Commonly used choices for the number of folds are <span class="math inline">\(k = 5 \text{ or }10\)</span>. In each iteration, <span class="math inline">\(k - 1\)</span> of the folds make up the analysis set, and the remaining fold makes up the assessment set. At the end of the <span class="math inline">\(k\)</span> iterations, the model’s overall performance is computed as an average of the performance statistic across all iterations. For example, if we use RMSE to evaluate performance, the model’s overall performance is the average RMSE across the <span class="math inline">\(k\)</span> iterations. <a href="#fig-cross-validation" class="quarto-xref">Figure&nbsp;<span>10.7</span></a> illustrates the folds, analysis set, and assessment sets for a 5-fold cross validation.</p>
<!--# need to update the figure - see notes on how-->
<div id="fig-cross-validation" class="quarto-float quarto-figure quarto-figure-center anchored" data-fig-align="center">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-cross-validation-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<a href="images/10-cross-validation.png" class="lightbox" data-gallery="quarto-lightbox-gallery-31" title="Figure&nbsp;10.7: Illustration of 5-fold cross validation. Solid blue = Analysis set, Striped green = Assessment set"><img src="images/10-cross-validation.png" class="img-fluid quarto-figure quarto-figure-center figure-img"></a>
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-cross-validation-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;10.7: Illustration of 5-fold cross validation. Solid blue = Analysis set, Striped green = Assessment set
</figcaption>
</figure>
</div>
<p>Because cross validation is only conducted on the training set, a measure of how the model performs on new data (the assessment set at each iteration) can be used to compare potential models and throughout the model building process. As before, the testing set is reserved for providing a final evaluation of the performance of the final model.</p>
<p>Below is the outline of a model building workflow workflow using cross-validation.</p>
<ol type="1">
<li>Split the data into training and testing sets. Set the testing set to the side!</li>
<li>Use simple random sampling to split the <u><strong>training set</strong></u> into <span class="math inline">\(k\)</span> folds.</li>
<li>For <span class="math inline">\(k\)</span> iterations
<ol type="i">
<li>Use <span class="math inline">\(k-1\)</span> folds in the analysis set to fit a candidate model. Compute model performance statistics such as <span class="math inline">\(\text{Adj. } R^2\)</span>, AIC, and BIC.</li>
<li>Use the remaining fold as the analysis set to evaluate the model’s ability to predict for new observations. Compute statistics such as <span class="math inline">\(R^2\)</span> and RMSE to evaluate model performance.</li>
<li>Repeat steps (i) and (ii) <span class="math inline">\(k\)</span> times, rotating which fold is the assessment set at each iteration.</li>
</ol></li>
<li>Compute the average model fit or performance statistic computed in Step 3 across the <span class="math inline">\(k\)</span> folds (e.g., average AIC or average RMSE) as the overall measure of the model performance.</li>
<li>Repeat Steps 3 and 4 for each candidate model. Use the overall performance statistic from Step 4 to select a final model.</li>
<li>Once the final model is selected, use the entire training set to refit the selected model.</li>
<li>Use the model fit in Step 6 to compute predictions on the <u><strong>testing set</strong></u>. Compute model performance statistics as a final measure of the model’s predictive performance.</li>
<li>Use the entire data set (training and testing set) to refit the selected model and get the final model coefficients.</li>
<li>Use the model from Step 8 for interpretation, inference and prediction.</li>
</ol>
<p>While doing cross validation, we are not necessarily concerned with the estimated regression coefficients or their interpretations. In fact, by the end of of Step 3, there will be <span class="math inline">\(k\)</span> similar (but different!) estimated values for each model coefficient. The purpose of cross validation is to evaluate how well the model predicts for data it has not seen before. It is at the last step of the process that we look closely at the model coefficients, their interpretations, and conclusions about the relationship between the response and predictor variables.</p>
<div class="analysis_in_practice">
<p>The most commonly used values for <span class="math inline">\(k\)</span>, the number of folds, are 5 and 10. There are few points to consider when choosing <span class="math inline">\(k\)</span>.</p>
<p><strong>Using a smaller value of</strong> <span class="math inline">\(k\)</span></p>
<ul>
<li><p>Use a smaller number of folds there are few observations in the training set. Only one fold is part of the assessment set used to evaluate the model performance at each iteration, so if <span class="math inline">\(k\)</span> is large, there will be very few observations in the assessment set.</p></li>
<li><p>Small values of <span class="math inline">\(k\)</span> tend to result in more biased estimates of the model performance statistic, for example RMSE. Biased estimates are far from the true (yet unknown!) population statistic, so they can result in an unreliable view of the model performance.</p></li>
</ul>
<p><br></p>
<p><strong>Using a larger value of</strong> <span class="math inline">\(k\)</span></p>
<ul>
<li><p>Cross-validation can be computationally intensive. Larger <span class="math inline">\(k\)</span> means more resampling and model refitting is required, which can result in long computational times, often for little added value.</p></li>
<li><p>Large values of <span class="math inline">\(k\)</span> result in more variability in the estimated model performance statistic, for example RMSE. This means at each iteration may produce very different estimates of the model performance, resulting in an unreliable evaluation of the model performance.</p></li>
</ul>
<p><br></p>
<p>Choosing <span class="math inline">\(k = 5\)</span> or <span class="math inline">\(k = 10\)</span> produces model performance statistics that have little bias and variability, while also reducing the computational intensity. See Chapter 3 of <span class="citation" data-cites="kuhn2019feature">Kuhn and Johnson (<a href="references.html#ref-kuhn2019feature" role="doc-biblioref">2019</a>)</span> and Chapter 5 of <span class="citation" data-cites="james2021introduction">James et al. (<a href="references.html#ref-james2021introduction" role="doc-biblioref">2021</a>)</span> for more discussion about choosing <span class="math inline">\(k\)</span>.</p>
</div>
</section>
<section id="example-cross-validation-workflow" class="level3" data-number="10.5.3">
<h3 data-number="10.5.3" class="anchored" data-anchor-id="example-cross-validation-workflow"><span class="header-section-number">10.5.3</span> Example: Cross validation workflow</h3>
<p>Here we illustrate the cross validation workflow to fit the full model using all predictors in <a href="#sec-spotify-intro" class="quarto-xref"><span>Section 10.1</span></a> to explain variability in the valence of the songs on Spotify. Recall from <a href="#sec-training-testing" class="quarto-xref"><span>Section 10.4</span></a> the training set has 2400 observations. The training set is split into five folds, with each having 480 observations.</p>
<div class="yourturn">
<p>Based on <a href="#fig-cross-validation" class="quarto-xref">Figure&nbsp;<span>10.7</span></a>, which fold(s) make up the analysis set and which make up the assessment set in the first iteration?</p>
<p>For the first iteration of cross validation on the Spotify training set, how many observations will be in the analysis set? How many in the assessment set?<a href="#fn7" class="footnote-ref" id="fnref7" role="doc-noteref"><sup>7</sup></a></p>
</div>
<div id="fig-spotify-folds" class="quarto-layout-panel">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-spotify-folds-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<div class="quarto-layout-row">
<div class="cell-output-display quarto-layout-cell-subref quarto-layout-cell" data-ref-parent="fig-spotify-folds" style="flex-basis: 33.3%;justify-content: flex-start;">
<div id="fig-spotify-folds-1" class="quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-subfloat-fig figure">
<div aria-describedby="fig-spotify-folds-1-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<a href="10-model-eval_files/figure-html/fig-spotify-folds-1.png" class="lightbox" data-gallery="fig-spotify-folds" title="Figure&nbsp;10.8&nbsp;(a): Fold 1"><img src="10-model-eval_files/figure-html/fig-spotify-folds-1.png" class="img-fluid figure-img" style="width:100.0%" data-ref-parent="fig-spotify-folds"></a>
</div>
<figcaption class="quarto-float-caption-bottom quarto-subfloat-caption quarto-subfloat-fig" id="fig-spotify-folds-1-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
(a) Fold 1
</figcaption>
</figure>
</div>
</div>
<div class="cell-output-display quarto-layout-cell-subref quarto-layout-cell" data-ref-parent="fig-spotify-folds" style="flex-basis: 33.3%;justify-content: flex-start;">
<div id="fig-spotify-folds-2" class="quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-subfloat-fig figure">
<div aria-describedby="fig-spotify-folds-2-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<a href="10-model-eval_files/figure-html/fig-spotify-folds-2.png" class="lightbox" data-gallery="fig-spotify-folds" title="Figure&nbsp;10.8&nbsp;(b): Fold 2"><img src="10-model-eval_files/figure-html/fig-spotify-folds-2.png" class="img-fluid figure-img" style="width:100.0%" data-ref-parent="fig-spotify-folds"></a>
</div>
<figcaption class="quarto-float-caption-bottom quarto-subfloat-caption quarto-subfloat-fig" id="fig-spotify-folds-2-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
(b) Fold 2
</figcaption>
</figure>
</div>
</div>
<div class="cell-output-display quarto-layout-cell-subref quarto-layout-cell" data-ref-parent="fig-spotify-folds" style="flex-basis: 33.3%;justify-content: flex-start;">
<div id="fig-spotify-folds-3" class="quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-subfloat-fig figure">
<div aria-describedby="fig-spotify-folds-3-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<a href="10-model-eval_files/figure-html/fig-spotify-folds-3.png" class="lightbox" data-gallery="fig-spotify-folds" title="Figure&nbsp;10.8&nbsp;(c): Fold 3"><img src="10-model-eval_files/figure-html/fig-spotify-folds-3.png" class="img-fluid figure-img" style="width:100.0%" data-ref-parent="fig-spotify-folds"></a>
</div>
<figcaption class="quarto-float-caption-bottom quarto-subfloat-caption quarto-subfloat-fig" id="fig-spotify-folds-3-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
(c) Fold 3
</figcaption>
</figure>
</div>
</div>
</div>
<div class="quarto-layout-row">
<div class="cell-output-display quarto-layout-cell-subref quarto-layout-cell" data-ref-parent="fig-spotify-folds" style="flex-basis: 33.3%;justify-content: flex-start;">
<div id="fig-spotify-folds-4" class="quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-subfloat-fig figure">
<div aria-describedby="fig-spotify-folds-4-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<a href="10-model-eval_files/figure-html/fig-spotify-folds-4.png" class="lightbox" data-gallery="fig-spotify-folds" title="Figure&nbsp;10.8&nbsp;(d): Fold 4"><img src="10-model-eval_files/figure-html/fig-spotify-folds-4.png" class="img-fluid figure-img" style="width:100.0%" data-ref-parent="fig-spotify-folds"></a>
</div>
<figcaption class="quarto-float-caption-bottom quarto-subfloat-caption quarto-subfloat-fig" id="fig-spotify-folds-4-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
(d) Fold 4
</figcaption>
</figure>
</div>
</div>
<div class="cell-output-display quarto-layout-cell-subref quarto-layout-cell" data-ref-parent="fig-spotify-folds" style="flex-basis: 33.3%;justify-content: flex-start;">
<div id="fig-spotify-folds-5" class="quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-subfloat-fig figure">
<div aria-describedby="fig-spotify-folds-5-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<a href="10-model-eval_files/figure-html/fig-spotify-folds-5.png" class="lightbox" data-gallery="fig-spotify-folds" title="Figure&nbsp;10.8&nbsp;(e): Fold 5"><img src="10-model-eval_files/figure-html/fig-spotify-folds-5.png" class="img-fluid figure-img" style="width:100.0%" data-ref-parent="fig-spotify-folds"></a>
</div>
<figcaption class="quarto-float-caption-bottom quarto-subfloat-caption quarto-subfloat-fig" id="fig-spotify-folds-5-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
(e) Fold 5
</figcaption>
</figure>
</div>
</div>
</div>
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-spotify-folds-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;10.8: Distribution of <code>valence</code> for 5 folds
</figcaption>
</figure>
</div>
<p><a href="#fig-spotify-folds" class="quarto-xref">Figure&nbsp;<span>10.8</span></a> shows the distribution of the the response variable <code>valence</code> for each fold. As we expect from random sampling, the distribution of <code>valence</code> is very similar across the folds.</p>
<p>Next, we fit the full model using the analysis set in each of the five iterations. Recall from <a href="#fig-cross-validation" class="quarto-xref">Figure&nbsp;<span>10.7</span></a>, that in each iteration the analysis set consists of four folds and one fold is held out as the assessment set. For example, from <a href="#fig-cross-validation" class="quarto-xref">Figure&nbsp;<span>10.7</span></a>, in Iteration 5, Folds 1 - 4 are the analysis set and Fold 5 is the assessment set.</p>
<div class="cell">
<div id="tbl-spotify-cv-models" class="cell quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-float-tbl figure">
<figcaption class="quarto-float-caption-top quarto-float-caption quarto-float-tbl" id="tbl-spotify-cv-models-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Table&nbsp;10.15: Model coefficients from 5-fold cross validation
</figcaption>
<div aria-describedby="tbl-spotify-cv-models-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<div class="cell-output-display">
<table class="do-not-create-environment cell caption-top table table-sm table-striped small">
<colgroup>
<col style="width: 25%">
<col style="width: 15%">
<col style="width: 15%">
<col style="width: 15%">
<col style="width: 15%">
<col style="width: 15%">
</colgroup>
<thead>
<tr class="header">
<th style="text-align: left;">Term</th>
<th style="text-align: right;">Iteration 1</th>
<th style="text-align: right;">Iteration 2</th>
<th style="text-align: right;">Iteration 3</th>
<th style="text-align: right;">Iteration 4</th>
<th style="text-align: right;">Iteration 5</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">(Intercept)</td>
<td style="text-align: right;">-0.432</td>
<td style="text-align: right;">-0.408</td>
<td style="text-align: right;">-0.484</td>
<td style="text-align: right;">-0.407</td>
<td style="text-align: right;">-0.420</td>
</tr>
<tr class="even">
<td style="text-align: left;">playlist_genrelatin</td>
<td style="text-align: right;">0.216</td>
<td style="text-align: right;">0.229</td>
<td style="text-align: right;">0.199</td>
<td style="text-align: right;">0.216</td>
<td style="text-align: right;">0.221</td>
</tr>
<tr class="odd">
<td style="text-align: left;">playlist_genrepop</td>
<td style="text-align: right;">0.167</td>
<td style="text-align: right;">0.178</td>
<td style="text-align: right;">0.151</td>
<td style="text-align: right;">0.181</td>
<td style="text-align: right;">0.187</td>
</tr>
<tr class="even">
<td style="text-align: left;">playlist_genrer&amp;b</td>
<td style="text-align: right;">0.215</td>
<td style="text-align: right;">0.222</td>
<td style="text-align: right;">0.205</td>
<td style="text-align: right;">0.224</td>
<td style="text-align: right;">0.228</td>
</tr>
<tr class="odd">
<td style="text-align: left;">playlist_genrerap</td>
<td style="text-align: right;">0.150</td>
<td style="text-align: right;">0.146</td>
<td style="text-align: right;">0.130</td>
<td style="text-align: right;">0.153</td>
<td style="text-align: right;">0.146</td>
</tr>
<tr class="even">
<td style="text-align: left;">playlist_genrerock</td>
<td style="text-align: right;">0.227</td>
<td style="text-align: right;">0.226</td>
<td style="text-align: right;">0.220</td>
<td style="text-align: right;">0.245</td>
<td style="text-align: right;">0.236</td>
</tr>
<tr class="odd">
<td style="text-align: left;">danceability</td>
<td style="text-align: right;">0.656</td>
<td style="text-align: right;">0.596</td>
<td style="text-align: right;">0.675</td>
<td style="text-align: right;">0.608</td>
<td style="text-align: right;">0.630</td>
</tr>
<tr class="even">
<td style="text-align: left;">energy</td>
<td style="text-align: right;">0.415</td>
<td style="text-align: right;">0.435</td>
<td style="text-align: right;">0.475</td>
<td style="text-align: right;">0.456</td>
<td style="text-align: right;">0.465</td>
</tr>
<tr class="odd">
<td style="text-align: left;">loudness</td>
<td style="text-align: right;">-0.007</td>
<td style="text-align: right;">-0.008</td>
<td style="text-align: right;">-0.009</td>
<td style="text-align: right;">-0.008</td>
<td style="text-align: right;">-0.008</td>
</tr>
<tr class="even">
<td style="text-align: left;">modeMinor</td>
<td style="text-align: right;">-0.009</td>
<td style="text-align: right;">0.002</td>
<td style="text-align: right;">-0.002</td>
<td style="text-align: right;">-0.007</td>
<td style="text-align: right;">0.001</td>
</tr>
<tr class="odd">
<td style="text-align: left;">acousticness</td>
<td style="text-align: right;">0.108</td>
<td style="text-align: right;">0.102</td>
<td style="text-align: right;">0.127</td>
<td style="text-align: right;">0.112</td>
<td style="text-align: right;">0.090</td>
</tr>
<tr class="even">
<td style="text-align: left;">liveness</td>
<td style="text-align: right;">0.055</td>
<td style="text-align: right;">0.020</td>
<td style="text-align: right;">-0.008</td>
<td style="text-align: right;">0.018</td>
<td style="text-align: right;">0.042</td>
</tr>
<tr class="odd">
<td style="text-align: left;">tempo</td>
<td style="text-align: right;">0.001</td>
<td style="text-align: right;">0.000</td>
<td style="text-align: right;">0.000</td>
<td style="text-align: right;">0.000</td>
<td style="text-align: right;">0.000</td>
</tr>
<tr class="even">
<td style="text-align: left;">duration_min</td>
<td style="text-align: right;">-0.018</td>
<td style="text-align: right;">-0.016</td>
<td style="text-align: right;">-0.013</td>
<td style="text-align: right;">-0.021</td>
<td style="text-align: right;">-0.025</td>
</tr>
</tbody>
</table>
</div>
</div>
</figure>
</div>
</div>
<p><a href="#tbl-spotify-cv-models" class="quarto-xref">Table&nbsp;<span>10.15</span></a> shows the estimated model coefficients from each iteration of cross validation. The coefficients are similar but not exactly the same across each iteration, because the analysis set used to fit the models at each iteration are similar but not exactly the same. The coefficients are displayed here to provide a glimpse into the process, but in practice we are not concerned with the estimates of the model coefficients at this point in the analysis. Instead, we are most concerned with the model performance.</p>
<div class="cell">
<div id="tbl-spotify-cv-stats" class="cell quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-float-tbl figure">
<figcaption class="quarto-float-caption-top quarto-float-caption quarto-float-tbl" id="tbl-spotify-cv-stats-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Table&nbsp;10.16: Model performance statistics on the assessment sets in 5-fold cross validation
</figcaption>
<div aria-describedby="tbl-spotify-cv-stats-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<div class="cell-output-display">
<table class="do-not-create-environment cell caption-top table table-sm table-striped small">
<thead>
<tr class="header">
<th style="text-align: left;">Fold</th>
<th style="text-align: right;">R<sup>2</sup></th>
<th style="text-align: right;">RMSE</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">Fold1</td>
<td style="text-align: right;">0.202</td>
<td style="text-align: right;">0.256</td>
</tr>
<tr class="even">
<td style="text-align: left;">Fold2</td>
<td style="text-align: right;">0.212</td>
<td style="text-align: right;">0.262</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Fold3</td>
<td style="text-align: right;">0.209</td>
<td style="text-align: right;">0.226</td>
</tr>
<tr class="even">
<td style="text-align: left;">Fold4</td>
<td style="text-align: right;">0.207</td>
<td style="text-align: right;">0.245</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Fold5</td>
<td style="text-align: right;">0.201</td>
<td style="text-align: right;">0.233</td>
</tr>
</tbody>
</table>
</div>
</div>
</figure>
</div>
</div>
<p><a href="#tbl-spotify-cv-stats" class="quarto-xref">Table&nbsp;<span>10.16</span></a> shows <span class="math inline">\(R^2\)</span> and RMSE computed from the assessment set in each iteration, measuring the model’s performance on new data. As with the model coefficients, there is some variability in these statistics, but they show a similar model fit. In practice, we are most interested in the average values across all folds. The average <span class="math inline">\(R^2\)</span> is 0.244 and the average RMSE is 0.206.</p>
<p>In practice, these values are most helpful when comparing multiple candidate models during the model selection process. Let’s compare the results of cross-validation for the full model to the results of cross-validation for the model selected by forward stepwise selection in <a href="#tbl-forward-final" class="quarto-xref">Table&nbsp;<span>10.8</span></a>. Note that we will use the same folds for both models, so that we are comparing the models’ performances on the same analysis and assessment sets.</p>
<div class="cell">
<div id="tbl-spotify-forward-full-cv" class="cell quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-float-tbl figure">
<figcaption class="quarto-float-caption-top quarto-float-caption quarto-float-tbl" id="tbl-spotify-forward-full-cv-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Table&nbsp;10.17: 5-fold cross validation results for full model and model selected by forward selection in <a href="#sec-stepwise-forward" class="quarto-xref"><span>Section 10.3.1</span></a>
</figcaption>
<div aria-describedby="tbl-spotify-forward-full-cv-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<div class="cell-output-display">
<table class="do-not-create-environment cell caption-top table table-sm table-striped small">
<thead>
<tr class="header">
<th style="text-align: left;">Model</th>
<th style="text-align: right;">RMSE</th>
<th style="text-align: right;">R-sq</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">Full model</td>
<td style="text-align: right;">0.206</td>
<td style="text-align: right;">0.244</td>
</tr>
<tr class="even">
<td style="text-align: left;">Forward selection</td>
<td style="text-align: right;">0.206</td>
<td style="text-align: right;">0.246</td>
</tr>
</tbody>
</table>
</div>
</div>
</figure>
</div>
</div>
<p>From <a href="#tbl-spotify-forward-full-cv" class="quarto-xref">Table&nbsp;<span>10.17</span></a>, the results from 5-fold cross validation are very similar for the full model and the model selected by forward selection. Thus, there is no clear preferred model based on these model performance results. At this point, we would rely on our judgment as data scientists and the original analysis objective to choose between these models. Given the aim to select the simplest model, we may choose the model selected by forward selection over the full model.</p>
<!--# do I need to use models where the results are more obvious?-->
</section>
</section>
<section id="model-evaluation-and-selection-in-r" class="level2" data-number="10.6">
<h2 data-number="10.6" class="anchored" data-anchor-id="model-evaluation-and-selection-in-r"><span class="header-section-number">10.6</span> Model evaluation and selection in R</h2>
<section id="model-comparison-statistics-in-r" class="level3" data-number="10.6.1">
<h3 data-number="10.6.1" class="anchored" data-anchor-id="model-comparison-statistics-in-r"><span class="header-section-number">10.6.1</span> Model comparison statistics in R</h3>
<p>The <code>glance()</code> function in the <strong>broom</strong> package <span class="citation" data-cites="broom-4">(<a href="references.html#ref-broom-4" role="doc-biblioref">Robinson, Hayes, and Couch 2025</a>)</span> is used to compute Adjusted <span class="math inline">\(R^2\)</span>, AIC, and BIC. It also includes other model fit statistics, such as log-likelihood used to compute AIC and BIC.</p>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb1"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a>spotify_model <span class="ot">&lt;-</span> <span class="fu">lm</span>(valence <span class="sc">~</span> danceability <span class="sc">+</span> mode <span class="sc">+</span> liveness, </span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a>                    <span class="at">data =</span> spotify)</span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a><span class="fu">glance</span>(spotify_model) <span class="sc">|&gt;</span> </span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(adj.r.squared, AIC, BIC)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 1 × 3
  adj.r.squared   AIC   BIC
          &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;
1        0.0951 -424. -394.</code></pre>
</div>
</div>
<p>The Root Mean Square Error is obtained by first computing the predicted values, then using <code>rmse()</code> from the <strong>yardstick</strong> package <span class="citation" data-cites="yardstick-3">(<a href="references.html#ref-yardstick-3" role="doc-biblioref">Kuhn, Vaughan, and Hvitfeldt 2025</a>)</span>. The code below uses <code>augment()</code> to compute the predicted values.</p>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb3"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a>spotify_model_aug <span class="ot">&lt;-</span> <span class="fu">augment</span>(spotify_model)</span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-3"><a href="#cb3-3" aria-hidden="true" tabindex="-1"></a><span class="fu">rmse</span>(spotify_model_aug, <span class="at">truth =</span> valence, <span class="at">estimate =</span> .fitted)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 1 × 3
  .metric .estimator .estimate
  &lt;chr&gt;   &lt;chr&gt;          &lt;dbl&gt;
1 rmse    standard       0.225</code></pre>
</div>
</div>
</section>
<section id="stepwise-model-selection-in-r" class="level3" data-number="10.6.2">
<h3 data-number="10.6.2" class="anchored" data-anchor-id="stepwise-model-selection-in-r"><span class="header-section-number">10.6.2</span> Stepwise model selection in R</h3>
<p>Forward and backward selection are conducted using the <code>step()</code> in the <strong>stats</strong> base R package. For both selection methods, we define the intercept-only model (called the <code>null_model</code>) and the model with all candidate predictors (called the <code>full_model</code>). The code below shows how to specify each model for the Spotify data analysis using various features of a song to predict valence.</p>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb5"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a>null_model <span class="ot">&lt;-</span> <span class="fu">lm</span>(valence <span class="sc">~</span> <span class="dv">1</span>, <span class="at">data =</span> spotify)</span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a>full_model <span class="ot">&lt;-</span> <span class="fu">lm</span>(valence <span class="sc">~</span>  playlist_genre <span class="sc">+</span> danceability <span class="sc">+</span> energy <span class="sc">+</span></span>
<span id="cb5-3"><a href="#cb5-3" aria-hidden="true" tabindex="-1"></a>                   loudness <span class="sc">+</span> mode <span class="sc">+</span>  acousticness <span class="sc">+</span> liveness <span class="sc">+</span> </span>
<span id="cb5-4"><a href="#cb5-4" aria-hidden="true" tabindex="-1"></a>                   tempo <span class="sc">+</span> duration_min, </span>
<span id="cb5-5"><a href="#cb5-5" aria-hidden="true" tabindex="-1"></a>                         <span class="at">data =</span> spotify)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
<p>Next is the code to conduct forward selection. The final model chosen by forward selection is saved as <code>forward_model</code>.</p>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb6"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a>forward_model <span class="ot">&lt;-</span> <span class="fu">step</span>(null_model,</span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true" tabindex="-1"></a>                      <span class="at">scope =</span> <span class="fu">formula</span>(full_model),</span>
<span id="cb6-3"><a href="#cb6-3" aria-hidden="true" tabindex="-1"></a>                      <span class="at">direction =</span> <span class="st">"forward"</span>, </span>
<span id="cb6-4"><a href="#cb6-4" aria-hidden="true" tabindex="-1"></a>                      <span class="at">trace =</span> <span class="dv">0</span>, </span>
<span id="cb6-5"><a href="#cb6-5" aria-hidden="true" tabindex="-1"></a>                      <span class="at">k =</span> <span class="dv">2</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
<p>The argument <code>trace = 0</code> will suppress all the intermediate results from the stepwise process. Use <code>trace = 1</code> to display output from each step of the forward selection.</p>
<p>The <code>step</code> function uses AIC as the selection criteria by default, as shown by <code>k = 2</code>. Use the argument <code>k = log(nrow(my_data))</code> to use BIC as the model selection criteria. For example, we use <code>k = log(nrow(spotify))</code> to use BIC as the selection criteria for this analysis.</p>
<p>The code for backward selection is similar to the code for forward selection. Primary differences are how the scope are defined and the direction.</p>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb7"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a>backward_selection <span class="ot">&lt;-</span> <span class="fu">step</span>(full_model,</span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a>                           <span class="at">scope =</span> <span class="fu">list</span>(<span class="at">lower =</span> <span class="fu">formula</span>(null_model), </span>
<span id="cb7-3"><a href="#cb7-3" aria-hidden="true" tabindex="-1"></a>                                        <span class="at">upper =</span> <span class="fu">formula</span>(full_model)),</span>
<span id="cb7-4"><a href="#cb7-4" aria-hidden="true" tabindex="-1"></a>                           <span class="at">direction =</span> <span class="st">"backward"</span>,</span>
<span id="cb7-5"><a href="#cb7-5" aria-hidden="true" tabindex="-1"></a>                           <span class="at">trace =</span> <span class="dv">0</span>, </span>
<span id="cb7-6"><a href="#cb7-6" aria-hidden="true" tabindex="-1"></a>                           <span class="at">k =</span> <span class="dv">2</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
<p>The <code>step</code> function can only use AIC or BIC as the model selection criteria. An alternative stepwise selection function is <code>regsubsets()</code> in the <strong>leaps</strong> R package <span class="citation" data-cites="leaps">(<a href="references.html#ref-leaps" role="doc-biblioref">Miller 2024</a>)</span>. It can use a variety of model selection criteria, such as Adjusted <span class="math inline">\(R^2\)</span>, and residual sum of squares (SSR, which is proportional to RMSE).</p>
<!--# need to address that the step() function uses a different formula for AIC and BIC than the glance function but they are proportional-->
</section>
<section id="training-and-testing-sets-in-r" class="level3" data-number="10.6.3">
<h3 data-number="10.6.3" class="anchored" data-anchor-id="training-and-testing-sets-in-r"><span class="header-section-number">10.6.3</span> Training and testing sets in R</h3>
<p>Data can be split into training and testing sets using functions from the <strong>resample</strong> package <span class="citation" data-cites="rsample">(<a href="references.html#ref-rsample" role="doc-biblioref">Frick et al. 2025</a>)</span>.</p>
<p>The function <code>initial_split()</code> is used to randomly assign observations to the training and testing set. The argument <code>prop =</code> defines the proportion of observations that are assigned to the training set. Because this is a random process, use <code>set.seed()</code> for reproducibility to ensure the same assignment each time the code is run.</p>
<p>The code below randomly assigns 80% of the observations to the training set and 20% of the observations to the testing set.</p>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb8"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">12345</span>)</span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-3"><a href="#cb8-3" aria-hidden="true" tabindex="-1"></a>spotify_split <span class="ot">&lt;-</span> <span class="fu">initial_split</span>(spotify, <span class="at">prop =</span> <span class="fl">0.8</span>)</span>
<span id="cb8-4"><a href="#cb8-4" aria-hidden="true" tabindex="-1"></a>spotify_split</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>&lt;Training/Testing/Total&gt;
&lt;2400/600/3000&gt;</code></pre>
</div>
</div>
<p>The data in the training and testing sets can be extracted using the functions <code>training()</code> and <code>testing()</code> respectively. We save the sets under the object names <code>spotify_train</code> and <code>spotify_test</code> and will call these objects in subsequent steps of the analysis.</p>
</section>
<section id="cross-validation-in-r" class="level3" data-number="10.6.4">
<h3 data-number="10.6.4" class="anchored" data-anchor-id="cross-validation-in-r"><span class="header-section-number">10.6.4</span> Cross validation in R</h3>
<p>We conduct cross validation using functions from the <strong>resample</strong> and <strong>workflows</strong> <span class="citation" data-cites="workflows">(<a href="references.html#ref-workflows" role="doc-biblioref">Vaughan and Couch 2025</a>)</span> packages. The folds are defined using the <code>vfold_cv()</code> in the <strong>resamples</strong> package. It uses the argument <code>v =</code> to define the number of folds. Below is the code to create the folds for 5-fold cross validation. Note that we use <code>spotify_train</code>, the training set.</p>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb10"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">12345</span>)</span>
<span id="cb10-2"><a href="#cb10-2" aria-hidden="true" tabindex="-1"></a>folds <span class="ot">&lt;-</span> <span class="fu">vfold_cv</span>(spotify_train, <span class="at">v =</span> <span class="dv">5</span>)</span>
<span id="cb10-3"><a href="#cb10-3" aria-hidden="true" tabindex="-1"></a>folds</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>#  5-fold cross-validation 
# A tibble: 5 × 2
  splits             id   
  &lt;list&gt;             &lt;chr&gt;
1 &lt;split [1920/480]&gt; Fold1
2 &lt;split [1920/480]&gt; Fold2
3 &lt;split [1920/480]&gt; Fold3
4 &lt;split [1920/480]&gt; Fold4
5 &lt;split [1920/480]&gt; Fold5</code></pre>
</div>
</div>
<p>The output indicates that for each fold, there are 1920 observations in the analysis set and 480 observations in the assessment set. If we wish to examine the data in each fold more closely (for example, as in <a href="#fig-spotify-folds" class="quarto-xref">Figure&nbsp;<span>10.8</span></a>), we are able to extract the data contained in each fold. Below is code to extract the data in the analysis and assessment sets for Fold 1.</p>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb12"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a>fold1_analysis <span class="ot">&lt;-</span> folds<span class="sc">$</span>splits[[<span class="dv">1</span>]] <span class="sc">|&gt;</span> <span class="fu">analysis</span>()</span>
<span id="cb12-2"><a href="#cb12-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-3"><a href="#cb12-3" aria-hidden="true" tabindex="-1"></a>fold1_assessment <span class="ot">&lt;-</span> folds<span class="sc">$</span>splits[[<span class="dv">1</span>]] <span class="sc">|&gt;</span> <span class="fu">assessment</span>()</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
<p>Once the folds are defined, we use the <code>workflow()</code>, <code>add_model()</code>, and <code>add_formula()</code> functions from the <strong>workflows</strong> package to specify the model that will be fit in each iteration of cross validation. The code below defines the workflow for fitting the full model from the Spotify data.</p>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="annotated-cell-9"><pre class="sourceCode r code-annotation-code code-with-copy code-annotated"><code class="sourceCode r"><a class="code-annotation-anchor" data-target-cell="annotated-cell-9" data-target-annotation="1" onclick="event.preventDefault();">1</a><span id="annotated-cell-9-1" class="code-annotation-target"><a href="#annotated-cell-9-1" aria-hidden="true" tabindex="-1"></a>spotify_workflow <span class="ot">&lt;-</span> <span class="fu">workflow</span>() <span class="sc">|&gt;</span></span>
<a class="code-annotation-anchor" data-target-cell="annotated-cell-9" data-target-annotation="2" onclick="event.preventDefault();">2</a><span id="annotated-cell-9-2" class="code-annotation-target"><a href="#annotated-cell-9-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">add_model</span>(<span class="fu">linear_reg</span>()) <span class="sc">|&gt;</span></span>
<span id="annotated-cell-9-3"><a href="#annotated-cell-9-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">add_formula</span>(valence <span class="sc">~</span> playlist_genre <span class="sc">+</span> danceability <span class="sc">+</span> energy <span class="sc">+</span> </span>
<span id="annotated-cell-9-4"><a href="#annotated-cell-9-4" aria-hidden="true" tabindex="-1"></a>                loudness <span class="sc">+</span> mode <span class="sc">+</span> acousticness <span class="sc">+</span> liveness <span class="sc">+</span> </span>
<a class="code-annotation-anchor" data-target-cell="annotated-cell-9" data-target-annotation="3" onclick="event.preventDefault();">3</a><span id="annotated-cell-9-5" class="code-annotation-target"><a href="#annotated-cell-9-5" aria-hidden="true" tabindex="-1"></a>                tempo <span class="sc">+</span> duration_min)</span><div class="code-annotation-gutter-bg"></div><div class="code-annotation-gutter"></div></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-annotation">
<dl class="code-annotation-container-grid">
<dt data-target-cell="annotated-cell-9" data-target-annotation="1">1</dt>
<dd>
<span data-code-cell="annotated-cell-9" data-code-lines="1" data-code-annotation="1">Initiate a modeling workflow for cross validation and save it as <code>spotify_workflow</code>.</span>
</dd>
<dt data-target-cell="annotated-cell-9" data-target-annotation="2">2</dt>
<dd>
<span data-code-cell="annotated-cell-9" data-code-lines="2" data-code-annotation="2">Specify model is in the form of a multiple linear regression model (see <a href="08-mlr-inference.html#eq-mlr-stat-model" class="quarto-xref">Equation&nbsp;<span>8.1</span></a>).</span>
</dd>
<dt data-target-cell="annotated-cell-9" data-target-annotation="3">3</dt>
<dd>
<span data-code-cell="annotated-cell-9" data-code-lines="5" data-code-annotation="3">Specify the response and predictor variables in the model.</span>
</dd>
</dl>
</div>
</div>
<p>Next, we use <code>fit_resamples()</code> from the <strong>rsamples</strong> package and <code>collect_metrics()</code> from the <strong>tune</strong> package <span class="citation" data-cites="tune">(<a href="references.html#ref-tune" role="doc-biblioref">Kuhn 2025</a>)</span> to fit the specified model to each of the 5 analysis sets and obtain the performance metrics.</p>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="annotated-cell-10"><pre class="sourceCode r code-annotation-code code-with-copy code-annotated"><code class="sourceCode r"><a class="code-annotation-anchor" data-target-cell="annotated-cell-10" data-target-annotation="1" onclick="event.preventDefault();">1</a><span id="annotated-cell-10-1" class="code-annotation-target"><a href="#annotated-cell-10-1" aria-hidden="true" tabindex="-1"></a>spotify_cv <span class="ot">&lt;-</span> spotify_workflow <span class="sc">|&gt;</span></span>
<a class="code-annotation-anchor" data-target-cell="annotated-cell-10" data-target-annotation="2" onclick="event.preventDefault();">2</a><span id="annotated-cell-10-2" class="code-annotation-target"><a href="#annotated-cell-10-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">fit_resamples</span>(<span class="at">resamples =</span> folds)</span>
<span id="annotated-cell-10-3"><a href="#annotated-cell-10-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="annotated-cell-10-4"><a href="#annotated-cell-10-4" aria-hidden="true" tabindex="-1"></a></span>
<a class="code-annotation-anchor" data-target-cell="annotated-cell-10" data-target-annotation="3" onclick="event.preventDefault();">3</a><span id="annotated-cell-10-5" class="code-annotation-target"><a href="#annotated-cell-10-5" aria-hidden="true" tabindex="-1"></a><span class="fu">collect_metrics</span>(spotify_cv, <span class="at">summarize =</span> <span class="cn">TRUE</span>)</span><div class="code-annotation-gutter-bg"></div><div class="code-annotation-gutter"></div></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-annotation">
<dl class="code-annotation-container-grid">
<dt data-target-cell="annotated-cell-10" data-target-annotation="1">1</dt>
<dd>
<span data-code-cell="annotated-cell-10" data-code-lines="1" data-code-annotation="1">Indicate we will use the model specification in <code>spotify_workflow</code>. Save the models fit in cross validation as <code>spotify_cv</code>.</span>
</dd>
<dt data-target-cell="annotated-cell-10" data-target-annotation="2">2</dt>
<dd>
<span data-code-cell="annotated-cell-10" data-code-lines="2" data-code-annotation="2">Fit the specified model to the analysis set in each fold saved in the object <code>fold</code>.</span>
</dd>
<dt data-target-cell="annotated-cell-10" data-target-annotation="3">3</dt>
<dd>
<span data-code-cell="annotated-cell-10" data-code-lines="5" data-code-annotation="3">Compute the average <span class="math inline">\(R^2\)</span> and RMSE across all iterations. These are the default performance metrics for linear models.</span>
</dd>
</dl>
</div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 2 × 6
  .metric .estimator  mean     n std_err .config        
  &lt;chr&gt;   &lt;chr&gt;      &lt;dbl&gt; &lt;int&gt;   &lt;dbl&gt; &lt;chr&gt;          
1 rmse    standard   0.207     5 0.00104 pre0_mod0_post0
2 rsq     standard   0.237     5 0.0113  pre0_mod0_post0</code></pre>
</div>
</div>
<p>The default for <code>collect_metrics()</code> is to produce the average performance statistics, as indicated by the argument <code>summarize = TRUE</code> . We can use <code>summarize = FALSE</code> to print the performance statistics for each iteration.</p>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb14"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a><span class="fu">collect_metrics</span>(spotify_cv, <span class="at">summarize =</span> <span class="cn">FALSE</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 10 × 5
  id    .metric .estimator .estimate .config        
  &lt;chr&gt; &lt;chr&gt;   &lt;chr&gt;          &lt;dbl&gt; &lt;chr&gt;          
1 Fold1 rmse    standard       0.207 pre0_mod0_post0
2 Fold1 rsq     standard       0.230 pre0_mod0_post0
3 Fold2 rmse    standard       0.206 pre0_mod0_post0
4 Fold2 rsq     standard       0.274 pre0_mod0_post0
5 Fold3 rmse    standard       0.210 pre0_mod0_post0
6 Fold3 rsq     standard       0.204 pre0_mod0_post0
# ℹ 4 more rows</code></pre>
</div>
</div>
<p>The full code workflow for 5-fold cross validation is below.</p>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="annotated-cell-12"><pre class="sourceCode r code-annotation-code code-with-copy"><code class="sourceCode r"><span id="annotated-cell-12-1"><a href="#annotated-cell-12-1" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">12345</span>)</span>
<span id="annotated-cell-12-2"><a href="#annotated-cell-12-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="annotated-cell-12-3"><a href="#annotated-cell-12-3" aria-hidden="true" tabindex="-1"></a><span class="co"># define the folds</span></span>
<span id="annotated-cell-12-4"><a href="#annotated-cell-12-4" aria-hidden="true" tabindex="-1"></a>folds <span class="ot">&lt;-</span> <span class="fu">vfold_cv</span>(spotify_train, <span class="at">v =</span> <span class="dv">5</span>)</span>
<span id="annotated-cell-12-5"><a href="#annotated-cell-12-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="annotated-cell-12-6"><a href="#annotated-cell-12-6" aria-hidden="true" tabindex="-1"></a><span class="co"># specify the model </span></span>
<span id="annotated-cell-12-7"><a href="#annotated-cell-12-7" aria-hidden="true" tabindex="-1"></a>spotify_workflow <span class="ot">&lt;-</span> <span class="fu">workflow</span>() <span class="sc">|&gt;</span> </span>
<span id="annotated-cell-12-8"><a href="#annotated-cell-12-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">add_model</span>(<span class="fu">linear_reg</span>()) <span class="sc">|&gt;</span> </span>
<span id="annotated-cell-12-9"><a href="#annotated-cell-12-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">add_formula</span>(valence <span class="sc">~</span> playlist_genre <span class="sc">+</span> danceability <span class="sc">+</span> energy <span class="sc">+</span> </span>
<span id="annotated-cell-12-10"><a href="#annotated-cell-12-10" aria-hidden="true" tabindex="-1"></a>                loudness <span class="sc">+</span> mode <span class="sc">+</span> acousticness <span class="sc">+</span> liveness <span class="sc">+</span> </span>
<span id="annotated-cell-12-11"><a href="#annotated-cell-12-11" aria-hidden="true" tabindex="-1"></a>                tempo <span class="sc">+</span> duration_min) </span>
<span id="annotated-cell-12-12"><a href="#annotated-cell-12-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="annotated-cell-12-13"><a href="#annotated-cell-12-13" aria-hidden="true" tabindex="-1"></a><span class="co"># fit the model to the analysis set in each fold</span></span>
<span id="annotated-cell-12-14"><a href="#annotated-cell-12-14" aria-hidden="true" tabindex="-1"></a>spotify_cv <span class="ot">&lt;-</span> spotify_workflow <span class="sc">|&gt;</span> </span>
<span id="annotated-cell-12-15"><a href="#annotated-cell-12-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">fit_resamples</span>(<span class="at">resamples =</span> folds)</span>
<span id="annotated-cell-12-16"><a href="#annotated-cell-12-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="annotated-cell-12-17"><a href="#annotated-cell-12-17" aria-hidden="true" tabindex="-1"></a><span class="co"># obtain performance statistics for each iteration</span></span>
<span id="annotated-cell-12-18"><a href="#annotated-cell-12-18" aria-hidden="true" tabindex="-1"></a><span class="fu">collect_metrics</span>(spotify_cv, <span class="at">summarize =</span> <span class="cn">TRUE</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
<p>There are many ways to customize cross validation, including the sampling process used to define the folds and the performance statistics computed at each iteration. We point interested readers to Chapter 10 of <span class="citation" data-cites="kuhn2022tidy">Kuhn and Silge (<a href="references.html#ref-kuhn2022tidy" role="doc-biblioref">2022</a>)</span> for more details on customizing cross validation in R.</p>
<!--# Do I add a section on shrinkage methods?-->
</section>
</section>
<section id="summary" class="level2" data-number="10.7">
<h2 data-number="10.7" class="anchored" data-anchor-id="summary"><span class="header-section-number">10.7</span> Summary</h2>
<p>In this chapter, we reviewed and introduced statistics for measuring model fit and predictive performance. We discussed how to determine which statistics to prioritize based on the primary modeling objective and introduced stepwise methods for model selection. We introduced a model selection workflow using training and testing sets, and expanded this with cross validation. Lastly, we described how to implement a complete model selection workflow and showed how to do so in R.</p>
<p>Here we introduced the basics of cross-validation, but there are many iterations of cross validation, including Leave One Out Cross Validation (LOOCV) and Monte Carlo cross validation. There are also extensions of the training and testing set, such as validation set that can be used alongside the training set in the model building process. We point readers to Chapters 10 and 11 of <span class="citation" data-cites="kuhn2022tidy">Kuhn and Silge (<a href="references.html#ref-kuhn2022tidy" role="doc-biblioref">2022</a>)</span> and Chapter 3 of <span class="citation" data-cites="kuhn2019feature">Kuhn and Johnson (<a href="references.html#ref-kuhn2019feature" role="doc-biblioref">2019</a>)</span> as starting points for more advanced discussion of these topics.</p>
<p>So far, we have discussed linear regression models for quantitative response variables. In <a href="11-logistic.html" class="quarto-xref"><span>Chapter 11</span></a>, we look beyond quantitative response variables and introduce logistic regression, models for categorical response variables.</p>


<div id="refs" class="references csl-bib-body hanging-indent" data-entry-spacing="0" role="list" style="display: none">
<div id="ref-akaike1974" class="csl-entry" role="listitem">
Akaike, H. 1974. <span>“A New Look at the Statistical Model Identification.”</span> <em>IEEE Transactions on Automatic Control</em> 19 (6): 716–23. <a href="https://doi.org/10.1109/TAC.1974.1100705">https://doi.org/10.1109/TAC.1974.1100705</a>.
</div>
<div id="ref-burnham2002model" class="csl-entry" role="listitem">
Burnham, Kenneth P, and David R Anderson. 2002. <em>Model Selection and Multimodel Inference: A Practical Information-Theoretic Approach</em>. Springer.
</div>
<div id="ref-hew2020musicinduction" class="csl-entry" role="listitem">
Campbell, Elizabeth, Elizaveta Berezina, and Gill Hew. 2020. <span>“The Effects of Music Induction on Mood and Affect in an Asian Context.”</span> <em>Psychology of Music</em> 49 (5): 1132–44. <a href="https://doi.org/10.1177/0305735620928578">https://doi.org/10.1177/0305735620928578</a>.
</div>
<div id="ref-tidytuesday" class="csl-entry" role="listitem">
Community, Data Science Learning. 2024. <span>“Tidy Tuesday: A Weekly Social Data Project.”</span> <a href="https://tidytues.day">https://tidytues.day</a>.
</div>
<div id="ref-rsample" class="csl-entry" role="listitem">
Frick, Hannah, Fanny Chow, Max Kuhn, Michael Mahoney, Julia Silge, and Hadley Wickham. 2025. <span>“Rsample: General Resampling Infrastructure.”</span> <a href="https://doi.org/10.32614/CRAN.package.rsample">https://doi.org/10.32614/CRAN.package.rsample</a>.
</div>
<div id="ref-howell2024soundmusic" class="csl-entry" role="listitem">
Howell, Joel, Dianne Singer, Erica Solway, Nicholas Box, Scott Roberts, Lauren Hutchens, Emily Smith, and Jeffrey Kullgren. 2024. <span>“The Sound of Music.”</span> <span>University of Michigan</span> National Poll on Healthy Aging. <a href="https://doi.org/10.7302/22174">https://doi.org/10.7302/22174</a>.
</div>
<div id="ref-james2021introduction" class="csl-entry" role="listitem">
James, Gareth, Daniela Witten, Trevor Hastie, and Robert Tibshirani. 2021. <em>An Introduction to Statistical Learning: With Applications in r</em>. 2nd ed. Springer.
</div>
<div id="ref-kass1995bayes" class="csl-entry" role="listitem">
Kass, Robert E, and Adrian E Raftery. 1995. <span>“Bayes Factors.”</span> <em>Journal of the American Statistical Association</em> 90 (430): 773–95.
</div>
<div id="ref-kubicek2022musichealth" class="csl-entry" role="listitem">
Kubicek, Lorrie. 2022. <span>“Can Music Improve Our Health and Quality of Life?”</span> July 25, 2022. <a href="https://www.health.harvard.edu/blog/can-music-improve-our-health-and-quality-of-life-202207252786">https://www.health.harvard.edu/blog/can-music-improve-our-health-and-quality-of-life-202207252786</a>.
</div>
<div id="ref-tune" class="csl-entry" role="listitem">
Kuhn, Max. 2025. <span>“Tune: Tidy Tuning Tools.”</span> <a href="https://doi.org/10.32614/CRAN.package.tune">https://doi.org/10.32614/CRAN.package.tune</a>.
</div>
<div id="ref-kuhn2019feature" class="csl-entry" role="listitem">
Kuhn, Max, and Kjell Johnson. 2019. <em>Feature Engineering and Selection: A Practical Approach for Predictive Models</em>. Chapman; Hall/CRC.
</div>
<div id="ref-kuhn2022tidy" class="csl-entry" role="listitem">
Kuhn, Max, and Julia Silge. 2022. <em>Tidy Modeling with r</em>. " O’Reilly Media, Inc.".
</div>
<div id="ref-yardstick-3" class="csl-entry" role="listitem">
Kuhn, Max, Davis Vaughan, and Emil Hvitfeldt. 2025. <span>“Yardstick: Tidy Characterizations of Model Performance.”</span> <a href="https://doi.org/10.32614/CRAN.package.yardstick">https://doi.org/10.32614/CRAN.package.yardstick</a>.
</div>
<div id="ref-macgregor2025moodmusic" class="csl-entry" role="listitem">
MacGregor, Emily. 2025. <span>“Music Can Lift Mood, Foster Community and Even Rewire Brains – but Does It Need to Have a Purpose?”</span> April 14, 2025. <a href="https://www.theguardian.com/music/2025/apr/14/mood-music-radio-3-unwind-emily-macgregor">https://www.theguardian.com/music/2025/apr/14/mood-music-radio-3-unwind-emily-macgregor</a>.
</div>
<div id="ref-leaps" class="csl-entry" role="listitem">
Miller, Thomas Lumley based on Fortran code by Alan. 2024. <span>“Leaps: Regression Subset Selection.”</span> <a href="https://doi.org/10.32614/CRAN.package.leaps">https://doi.org/10.32614/CRAN.package.leaps</a>.
</div>
<div id="ref-pavlik2019classifying" class="csl-entry" role="listitem">
Pavlik, Kaylin. 2019. <span>“Understanding + Classifying Genres Using Spotify Audio Features.”</span> <a href="https://www.kaylinpavlik.com/classifying-songs-genres/" class="uri">https://www.kaylinpavlik.com/classifying-songs-genres/</a>.
</div>
<div id="ref-broom-4" class="csl-entry" role="listitem">
Robinson, David, Alex Hayes, and Simon Couch. 2025. <span>“Broom: Convert Statistical Objects into Tidy Tibbles.”</span> <a href="https://doi.org/10.32614/CRAN.package.broom">https://doi.org/10.32614/CRAN.package.broom</a>.
</div>
<div id="ref-schwarz1978estimating" class="csl-entry" role="listitem">
Schwarz, Gideon. 1978. <span>“Estimating the Dimension of a Model.”</span> <em>The Annals of Statistics</em>, 461–64.
</div>
<div id="ref-SpotifyGetAudioFeatures" class="csl-entry" role="listitem">
Spotify for Developers. n.d. <span>“Get Audio Features (Spotify Web API Reference).”</span> Online Documentation. <a href="https://developer.spotify.com/documentation/web-api/reference/get-audio-features">https://developer.spotify.com/documentation/web-api/reference/get-audio-features</a>.
</div>
<div id="ref-taruffi2017effects" class="csl-entry" role="listitem">
Taruffi, Liila, Corinna Pehrs, Stavros Skouras, and Stefan Koelsch. 2017. <span>“Effects of Sad and Happy Music on Mind-Wandering and the Default Mode Network.”</span> <em>Scientific Reports</em> 7 (1): 14396. <a href="https://doi.org/10.1038/s41598-017-14849-0">https://doi.org/10.1038/s41598-017-14849-0</a>.
</div>
<div id="ref-workflows" class="csl-entry" role="listitem">
Vaughan, Davis, and Simon Couch. 2025. <span>“Workflows: Modeling Workflows.”</span> <a href="https://doi.org/10.32614/CRAN.package.workflows">https://doi.org/10.32614/CRAN.package.workflows</a>.
</div>
</div>
</section>
<section id="footnotes" class="footnotes footnotes-end-of-document" role="doc-endnotes">
<hr>
<ol>
<li id="fn1"><p>Answers may vary. Danceability and Energy appear to be the most strongly associated with valence based the bivariate graphs. Both show a positive relationship - more danceable songs tend to be more positive and more high energy songs to be more positive.<a href="#fnref1" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
<li id="fn2"><p>We generally select the model with lower RMSE, because it means the model is producing more accurate predictions, on average.<a href="#fnref2" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
<li id="fn3"><p>Based on <span class="citation" data-cites="kass1995bayes">(<a href="references.html#ref-kass1995bayes" role="doc-biblioref">Kass and Raftery 1995</a>)</span><a href="#fnref3" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
<li id="fn4"><p>Based on <span class="citation" data-cites="burnham2002model">(<a href="references.html#ref-burnham2002model" role="doc-biblioref">Burnham and Anderson 2002</a>, pg. 70)</span><a href="#fnref4" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
<li id="fn5"><p>We would choose the model with the single predictor <code>danceability</code> based on AIC, because it has the smaller value. The same is true for BIC. Based on the guidelines in <a href="#tbl-aic-bic-guidelines" class="quarto-xref">Table&nbsp;<span>10.3</span></a>, AIC gives weak evidence and BIC gives very strong evidence in favor of this model.<a href="#fnref5" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
<li id="fn6"><p>The training set. The training set is used for the entire model building process.<a href="#fnref6" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
<li id="fn7"><p>Based on <a href="#fig-cross-validation" class="quarto-xref">Figure&nbsp;<span>10.7</span></a>, Folds 2 - 5 are the analysis set and Fold 1 is the assessment set in Iteration 1. There will be 1920 observations in the analysis set (4 folds) and 480 observations in the assessment set (1 fold).<a href="#fnref7" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
</ol>
</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
  window.document.addEventListener("DOMContentLoaded", function (event) {
    const icon = "";
    const anchorJS = new window.AnchorJS();
    anchorJS.options = {
      placement: 'right',
      icon: icon
    };
    anchorJS.add('.anchored');
    const isCodeAnnotation = (el) => {
      for (const clz of el.classList) {
        if (clz.startsWith('code-annotation-')) {                     
          return true;
        }
      }
      return false;
    }
    const onCopySuccess = function(e) {
      // button target
      const button = e.trigger;
      // don't keep focus
      button.blur();
      // flash "checked"
      button.classList.add('code-copy-button-checked');
      var currentTitle = button.getAttribute("title");
      button.setAttribute("title", "Copied!");
      let tooltip;
      if (window.bootstrap) {
        button.setAttribute("data-bs-toggle", "tooltip");
        button.setAttribute("data-bs-placement", "left");
        button.setAttribute("data-bs-title", "Copied!");
        tooltip = new bootstrap.Tooltip(button, 
          { trigger: "manual", 
            customClass: "code-copy-button-tooltip",
            offset: [0, -8]});
        tooltip.show();    
      }
      setTimeout(function() {
        if (tooltip) {
          tooltip.hide();
          button.removeAttribute("data-bs-title");
          button.removeAttribute("data-bs-toggle");
          button.removeAttribute("data-bs-placement");
        }
        button.setAttribute("title", currentTitle);
        button.classList.remove('code-copy-button-checked');
      }, 1000);
      // clear code selection
      e.clearSelection();
    }
    const getTextToCopy = function(trigger) {
      const outerScaffold = trigger.parentElement.cloneNode(true);
      const codeEl = outerScaffold.querySelector('code');
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
    const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
      text: getTextToCopy
    });
    clipboard.on('success', onCopySuccess);
    if (window.document.getElementById('quarto-embedded-source-code-modal')) {
      const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
        text: getTextToCopy,
        container: window.document.getElementById('quarto-embedded-source-code-modal')
      });
      clipboardModal.on('success', onCopySuccess);
    }
      var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
      var mailtoRegex = new RegExp(/^mailto:/);
        var filterRegex = new RegExp("https:\/\/introregressio\.netlify\.app");
      var isInternal = (href) => {
          return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
      }
      // Inspect non-navigation links and adorn them if external
     var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
      for (var i=0; i<links.length; i++) {
        const link = links[i];
        if (!isInternal(link.href)) {
          // undo the damage that might have been done by quarto-nav.js in the case of
          // links that we want to consider external
          if (link.dataset.originalHref !== undefined) {
            link.href = link.dataset.originalHref;
          }
        }
      }
    function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
      const config = {
        allowHTML: true,
        maxWidth: 500,
        delay: 100,
        arrow: false,
        appendTo: function(el) {
            return el.parentElement;
        },
        interactive: true,
        interactiveBorder: 10,
        theme: 'quarto',
        placement: 'bottom-start',
      };
      if (contentFn) {
        config.content = contentFn;
      }
      if (onTriggerFn) {
        config.onTrigger = onTriggerFn;
      }
      if (onUntriggerFn) {
        config.onUntrigger = onUntriggerFn;
      }
      window.tippy(el, config); 
    }
    const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
    for (var i=0; i<noterefs.length; i++) {
      const ref = noterefs[i];
      tippyHover(ref, function() {
        // use id or data attribute instead here
        let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
        try { href = new URL(href).hash; } catch {}
        const id = href.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note) {
          return note.innerHTML;
        } else {
          return "";
        }
      });
    }
    const xrefs = window.document.querySelectorAll('a.quarto-xref');
    const processXRef = (id, note) => {
      // Strip column container classes
      const stripColumnClz = (el) => {
        el.classList.remove("page-full", "page-columns");
        if (el.children) {
          for (const child of el.children) {
            stripColumnClz(child);
          }
        }
      }
      stripColumnClz(note)
      if (id === null || id.startsWith('sec-')) {
        // Special case sections, only their first couple elements
        const container = document.createElement("div");
        if (note.children && note.children.length > 2) {
          container.appendChild(note.children[0].cloneNode(true));
          for (let i = 1; i < note.children.length; i++) {
            const child = note.children[i];
            if (child.tagName === "P" && child.innerText === "") {
              continue;
            } else {
              container.appendChild(child.cloneNode(true));
              break;
            }
          }
          if (window.Quarto?.typesetMath) {
            window.Quarto.typesetMath(container);
          }
          return container.innerHTML
        } else {
          if (window.Quarto?.typesetMath) {
            window.Quarto.typesetMath(note);
          }
          return note.innerHTML;
        }
      } else {
        // Remove any anchor links if they are present
        const anchorLink = note.querySelector('a.anchorjs-link');
        if (anchorLink) {
          anchorLink.remove();
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        if (note.classList.contains("callout")) {
          return note.outerHTML;
        } else {
          return note.innerHTML;
        }
      }
    }
    for (var i=0; i<xrefs.length; i++) {
      const xref = xrefs[i];
      tippyHover(xref, undefined, function(instance) {
        instance.disable();
        let url = xref.getAttribute('href');
        let hash = undefined; 
        if (url.startsWith('#')) {
          hash = url;
        } else {
          try { hash = new URL(url).hash; } catch {}
        }
        if (hash) {
          const id = hash.replace(/^#\/?/, "");
          const note = window.document.getElementById(id);
          if (note !== null) {
            try {
              const html = processXRef(id, note.cloneNode(true));
              instance.setContent(html);
            } finally {
              instance.enable();
              instance.show();
            }
          } else {
            // See if we can fetch this
            fetch(url.split('#')[0])
            .then(res => res.text())
            .then(html => {
              const parser = new DOMParser();
              const htmlDoc = parser.parseFromString(html, "text/html");
              const note = htmlDoc.getElementById(id);
              if (note !== null) {
                const html = processXRef(id, note);
                instance.setContent(html);
              } 
            }).finally(() => {
              instance.enable();
              instance.show();
            });
          }
        } else {
          // See if we can fetch a full url (with no hash to target)
          // This is a special case and we should probably do some content thinning / targeting
          fetch(url)
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.querySelector('main.content');
            if (note !== null) {
              // This should only happen for chapter cross references
              // (since there is no id in the URL)
              // remove the first header
              if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
                note.children[0].remove();
              }
              const html = processXRef(null, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      }, function(instance) {
      });
    }
        let selectedAnnoteEl;
        const selectorForAnnotation = ( cell, annotation) => {
          let cellAttr = 'data-code-cell="' + cell + '"';
          let lineAttr = 'data-code-annotation="' +  annotation + '"';
          const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
          return selector;
        }
        const selectCodeLines = (annoteEl) => {
          const doc = window.document;
          const targetCell = annoteEl.getAttribute("data-target-cell");
          const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
          const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
          const lines = annoteSpan.getAttribute("data-code-lines").split(",");
          const lineIds = lines.map((line) => {
            return targetCell + "-" + line;
          })
          let top = null;
          let height = null;
          let parent = null;
          if (lineIds.length > 0) {
              //compute the position of the single el (top and bottom and make a div)
              const el = window.document.getElementById(lineIds[0]);
              top = el.offsetTop;
              height = el.offsetHeight;
              parent = el.parentElement.parentElement;
            if (lineIds.length > 1) {
              const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
              const bottom = lastEl.offsetTop + lastEl.offsetHeight;
              height = bottom - top;
            }
            if (top !== null && height !== null && parent !== null) {
              // cook up a div (if necessary) and position it 
              let div = window.document.getElementById("code-annotation-line-highlight");
              if (div === null) {
                div = window.document.createElement("div");
                div.setAttribute("id", "code-annotation-line-highlight");
                div.style.position = 'absolute';
                parent.appendChild(div);
              }
              div.style.top = top - 2 + "px";
              div.style.height = height + 4 + "px";
              div.style.left = 0;
              let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
              if (gutterDiv === null) {
                gutterDiv = window.document.createElement("div");
                gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
                gutterDiv.style.position = 'absolute';
                const codeCell = window.document.getElementById(targetCell);
                const gutter = codeCell.querySelector('.code-annotation-gutter');
                gutter.appendChild(gutterDiv);
              }
              gutterDiv.style.top = top - 2 + "px";
              gutterDiv.style.height = height + 4 + "px";
            }
            selectedAnnoteEl = annoteEl;
          }
        };
        const unselectCodeLines = () => {
          const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
          elementsIds.forEach((elId) => {
            const div = window.document.getElementById(elId);
            if (div) {
              div.remove();
            }
          });
          selectedAnnoteEl = undefined;
        };
          // Handle positioning of the toggle
      window.addEventListener(
        "resize",
        throttle(() => {
          elRect = undefined;
          if (selectedAnnoteEl) {
            selectCodeLines(selectedAnnoteEl);
          }
        }, 10)
      );
      function throttle(fn, ms) {
      let throttle = false;
      let timer;
        return (...args) => {
          if(!throttle) { // first call gets through
              fn.apply(this, args);
              throttle = true;
          } else { // all the others get throttled
              if(timer) clearTimeout(timer); // cancel #2
              timer = setTimeout(() => {
                fn.apply(this, args);
                timer = throttle = false;
              }, ms);
          }
        };
      }
        // Attach click handler to the DT
        const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
        for (const annoteDlNode of annoteDls) {
          annoteDlNode.addEventListener('click', (event) => {
            const clickedEl = event.target;
            if (clickedEl !== selectedAnnoteEl) {
              unselectCodeLines();
              const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
              if (activeEl) {
                activeEl.classList.remove('code-annotation-active');
              }
              selectCodeLines(clickedEl);
              clickedEl.classList.add('code-annotation-active');
            } else {
              // Unselect the line
              unselectCodeLines();
              clickedEl.classList.remove('code-annotation-active');
            }
          });
        }
    const findCites = (el) => {
      const parentEl = el.parentElement;
      if (parentEl) {
        const cites = parentEl.dataset.cites;
        if (cites) {
          return {
            el,
            cites: cites.split(' ')
          };
        } else {
          return findCites(el.parentElement)
        }
      } else {
        return undefined;
      }
    };
    var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
    for (var i=0; i<bibliorefs.length; i++) {
      const ref = bibliorefs[i];
      const citeInfo = findCites(ref);
      if (citeInfo) {
        tippyHover(citeInfo.el, function() {
          var popup = window.document.createElement('div');
          citeInfo.cites.forEach(function(cite) {
            var citeDiv = window.document.createElement('div');
            citeDiv.classList.add('hanging-indent');
            citeDiv.classList.add('csl-entry');
            var biblioDiv = window.document.getElementById('ref-' + cite);
            if (biblioDiv) {
              citeDiv.innerHTML = biblioDiv.innerHTML;
            }
            popup.appendChild(citeDiv);
          });
          return popup.innerHTML;
        });
      }
    }
  });
  </script>
<nav class="page-navigation">
  <div class="nav-page nav-page-previous">
      <a href="./09-mlr-transformations.html" class="pagination-link" aria-label="Variable transformations">
        <i class="bi bi-arrow-left-short"></i> <span class="nav-page-text"><span class="chapter-number">9</span>&nbsp; <span class="chapter-title">Variable transformations</span></span>
      </a>          
  </div>
  <div class="nav-page nav-page-next">
      <a href="./11-logistic.html" class="pagination-link" aria-label="Logistic regression">
        <span class="nav-page-text"><span class="chapter-number">11</span>&nbsp; <span class="chapter-title">Logistic regression</span></span> <i class="bi bi-arrow-right-short"></i>
      </a>
  </div>
</nav>
</div> <!-- /content -->
<footer class="footer"><div class="nav-footer"><div class="nav-footer-center"><div class="toc-actions d-sm-block d-md-none"><ul><li><a href="https://github.com/matackett/regression-book/issues/new" class="toc-action"><i class="bi bi-github"></i>Report an issue</a></li></ul></div></div></div></footer><script>var lightboxQuarto = GLightbox({"closeEffect":"zoom","descPosition":"bottom","loop":false,"openEffect":"zoom","selector":".lightbox"});
(function() {
  let previousOnload = window.onload;
  window.onload = () => {
    if (previousOnload) {
      previousOnload();
    }
    lightboxQuarto.on('slide_before_load', (data) => {
      const { slideIndex, slideNode, slideConfig, player, trigger } = data;
      const href = trigger.getAttribute('href');
      if (href !== null) {
        const imgEl = window.document.querySelector(`a[href="${href}"] img`);
        if (imgEl !== null) {
          const srcAttr = imgEl.getAttribute("src");
          if (srcAttr && srcAttr.startsWith("data:")) {
            slideConfig.href = srcAttr;
          }
        }
      } 
    });
  
    lightboxQuarto.on('slide_after_load', (data) => {
      const { slideIndex, slideNode, slideConfig, player, trigger } = data;
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(slideNode);
      }
    });
  
  };
  
})();
          </script>




</body></html>